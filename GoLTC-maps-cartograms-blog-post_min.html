<!DOCTYPE html>

<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><head>
<meta charset="utf-8"/>
<meta content="quarto-1.4.268" name="generator"/>
<meta content="width=device-width, initial-scale=1.0, user-scalable=yes" name="viewport"/>
<meta content="Sam Rickman" name="author"/>
<title>Communicating the findings of long-term care research</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>





<link href="GoLTC-maps-cartograms-blog-post_files/libs/quarto-html/tippy.css" rel="stylesheet"/>
<link href="GoLTC-maps-cartograms-blog-post_files/libs/quarto-html/quarto-syntax-highlighting.css" id="quarto-text-highlighting-styles" rel="stylesheet"/>

<link href="GoLTC-maps-cartograms-blog-post_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet"/>
<link data-mode="light" href="GoLTC-maps-cartograms-blog-post_files/libs/bootstrap/bootstrap.min.css" id="quarto-bootstrap" rel="stylesheet"/>


<link href="GoLTC-maps-cartograms-blog-post_files/libs/quarto-diagram/mermaid.css" rel="stylesheet"/>


<link href="GoLTC-maps-cartograms-blog-post_files/libs/leaflet-1.3.1/leaflet.css" rel="stylesheet"/>

<link href="GoLTC-maps-cartograms-blog-post_files/libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet"/>


<link href="GoLTC-maps-cartograms-blog-post_files/libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet"/>



<link href="GoLTC-maps-cartograms-blog-post_files/libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet"/>

<link href="GoLTC-maps-cartograms-blog-post_files/libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet"/>
<link href="GoLTC-maps-cartograms-blog-post_files/libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet"/>

<link href="GoLTC-maps-cartograms-blog-post_files/libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet"/>


<link href="GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/css/motion.css" rel="stylesheet"/>
















































<script>
  
    const loadScript = (file_url, async = true, type = "text/javascript", appendToHead = true) => {
        return new Promise((resolve, reject) => {
            try {
                const scriptEle = document.createElement("script");
                scriptEle.type = type;
                scriptEle.async = async;
                scriptEle.src = file_url;
                scriptEle.addEventListener("load", (ev) => {
                    resolve({ status: true });
                });
                scriptEle.addEventListener("error", (ev) => {
                    reject({
                        status: false,
                        message: `Failed to load the script ${file_url}`
                    });
                });
                appendToHead ? document.head.appendChild(scriptEle) : document.body.appendChild(scriptEle);
            } catch (error) {
                reject(error);
            }
        });
    };
  
  
  fetch("./GoLTC-maps-cartograms-blog-post_files/data/us_polygons.json")
    .then((response) => response.json())
    .then(
      (json) =>
        (document.querySelectorAll('[data-for="us_polygons"]')[0].innerHTML =
          JSON.stringify(json).replaceAll("/", "/"))
    )
  
  
      .then(() => fetch("./GoLTC-maps-cartograms-blog-post_files/data/cart_dorling.json"))
      .then((response) => response.json())
      .then(
        (json) =>
          (document.querySelectorAll('[data-for="cart_dorling"]')[0].innerHTML =
            JSON.stringify(json).replaceAll("/", "/"))
      )
    
      .then(() => fetch("./GoLTC-maps-cartograms-blog-post_files/data/htmlwidget-76dc5aad5e2079b3771a.json"))
      .then((response) => response.json())
      .then(
        (json) =>
          (document.querySelectorAll('[data-for="htmlwidget-76dc5aad5e2079b3771a"]')[0].innerHTML =
            JSON.stringify(json).replaceAll("/", "/"))
      )
    
      .then(() => fetch("./GoLTC-maps-cartograms-blog-post_files/data/htmlwidget-5703bbc8ee2887e83d10.json"))
      .then((response) => response.json())
      .then(
        (json) =>
          (document.querySelectorAll('[data-for="htmlwidget-5703bbc8ee2887e83d10"]')[0].innerHTML =
            JSON.stringify(json).replaceAll("/", "/"))
      )
    
      .then(() => fetch("./GoLTC-maps-cartograms-blog-post_files/data/leafletStandardMap.json"))
      .then((response) => response.json())
      .then(
        (json) =>
          (document.querySelectorAll('[data-for="leafletStandardMap"]')[0].innerHTML =
            JSON.stringify(json).replaceAll("/", "/"))
      )
    
      .then(() => fetch("./GoLTC-maps-cartograms-blog-post_files/data/htmlwidget-381d05ac1add2aa4e872.json"))
      .then((response) => response.json())
      .then(
        (json) =>
          (document.querySelectorAll('[data-for="htmlwidget-381d05ac1add2aa4e872"]')[0].innerHTML =
            JSON.stringify(json).replaceAll("/", "/"))
      )
    
      .then(() => fetch("./GoLTC-maps-cartograms-blog-post_files/data/eng_hex.json"))
      .then((response) => response.json())
      .then(
        (json) =>
          (document.querySelectorAll('[data-for="eng_hex"]')[0].innerHTML =
            JSON.stringify(json).replaceAll("/", "/"))
      )
    
      .then(() => fetch("./GoLTC-maps-cartograms-blog-post_files/data/htmlwidget-cd8ebe18a04efbadcb87.json"))
      .then((response) => response.json())
      .then(
        (json) =>
          (document.querySelectorAll('[data-for="htmlwidget-cd8ebe18a04efbadcb87"]')[0].innerHTML =
            JSON.stringify(json).replaceAll("/", "/"))
      )
    
      .then(() => fetch("./GoLTC-maps-cartograms-blog-post_files/data/leafletBlackCont.json"))
      .then((response) => response.json())
      .then(
        (json) =>
          (document.querySelectorAll('[data-for="leafletBlackCont"]')[0].innerHTML =
            JSON.stringify(json).replaceAll("/", "/"))
      )
    
      .then(() => fetch("./GoLTC-maps-cartograms-blog-post_files/data/leafletBlackNcont.json"))
      .then((response) => response.json())
      .then(
        (json) =>
          (document.querySelectorAll('[data-for="leafletBlackNcont"]')[0].innerHTML =
            JSON.stringify(json).replaceAll("/", "/"))
      )
    
      .then(() => fetch("./GoLTC-maps-cartograms-blog-post_files/data/htmlwidget-3015.json"))
      .then((response) => response.json())
      .then(
        (json) =>
          (document.querySelectorAll('[data-for="htmlwidget-3015"]')[0].innerHTML =
            JSON.stringify(json).replaceAll("/", "/"))
      )
    
      .then(() => fetch("./GoLTC-maps-cartograms-blog-post_files/data/htmlwidget-7442.json"))
      .then((response) => response.json())
      .then(
        (json) =>
          (document.querySelectorAll('[data-for="htmlwidget-7442"]')[0].innerHTML =
            JSON.stringify(json).replaceAll("/", "/"))
      )
    
      .then(() => fetch("./GoLTC-maps-cartograms-blog-post_files/data/htmlwidget-3927.json"))
      .then((response) => response.json())
      .then(
        (json) =>
          (document.querySelectorAll('[data-for="htmlwidget-3927"]')[0].innerHTML =
            JSON.stringify(json).replaceAll("/", "/"))
      )
    
      .then(() => fetch("./GoLTC-maps-cartograms-blog-post_files/data/htmlwidget-9627.json"))
      .then((response) => response.json())
      .then(
        (json) =>
          (document.querySelectorAll('[data-for="htmlwidget-9627"]')[0].innerHTML =
            JSON.stringify(json).replaceAll("/", "/"))
      )
    
      .then(() => fetch("./GoLTC-maps-cartograms-blog-post_files/data/htmlwidget-3246.json"))
      .then((response) => response.json())
      .then(
        (json) =>
          (document.querySelectorAll('[data-for="htmlwidget-3246"]')[0].innerHTML =
            JSON.stringify(json).replaceAll("/", "/"))
      )
    
      .then(() => fetch("./GoLTC-maps-cartograms-blog-post_files/data/htmlwidget-1362.json"))
      .then((response) => response.json())
      .then(
        (json) =>
          (document.querySelectorAll('[data-for="htmlwidget-1362"]')[0].innerHTML =
            JSON.stringify(json).replaceAll("/", "/"))
      )
    
      .then(() => fetch("./GoLTC-maps-cartograms-blog-post_files/data/htmlwidget-1221.json"))
      .then((response) => response.json())
      .then(
        (json) =>
          (document.querySelectorAll('[data-for="htmlwidget-1221"]')[0].innerHTML =
            JSON.stringify(json).replaceAll("/", "/"))
      )
    
      .then(() => fetch("./GoLTC-maps-cartograms-blog-post_files/data/htmlwidget-9552.json"))
      .then((response) => response.json())
      .then(
        (json) =>
          (document.querySelectorAll('[data-for="htmlwidget-9552"]')[0].innerHTML =
            JSON.stringify(json).replaceAll("/", "/"))
      )
    
      .then(() => fetch("./GoLTC-maps-cartograms-blog-post_files/data/htmlwidget-4255.json"))
      .then((response) => response.json())
      .then(
        (json) =>
          (document.querySelectorAll('[data-for="htmlwidget-4255"]')[0].innerHTML =
            JSON.stringify(json).replaceAll("/", "/"))
      )
    
      .then(() => fetch("./GoLTC-maps-cartograms-blog-post_files/data/htmlwidget-2d8285741add3f8eefcb.json"))
      .then((response) => response.json())
      .then(
        (json) =>
          (document.querySelectorAll('[data-for="htmlwidget-2d8285741add3f8eefcb"]')[0].innerHTML =
            JSON.stringify(json).replaceAll("/", "/"))
      )
    
      .then(() => fetch("./GoLTC-maps-cartograms-blog-post_files/data/leafletBlackDorling.json"))
      .then((response) => response.json())
      .then(
        (json) =>
          (document.querySelectorAll('[data-for="leafletBlackDorling"]')[0].innerHTML =
            JSON.stringify(json).replaceAll("/", "/"))
      )
    
  .then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/clipboard/clipboard.min.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/quarto-html/quarto.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/quarto-html/popper.min.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/quarto-html/tippy.umd.min.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/quarto-html/anchor.min.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/bootstrap/bootstrap.min.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/quarto-diagram/mermaid.min.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/quarto-diagram/mermaid-init.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/htmlwidgets-1.6.2/htmlwidgets.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/jquery-3.6.0/jquery-3.6.0.min.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/leaflet-1.3.1/leaflet.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/proj4-2.6.2/proj4.min.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/Proj4Leaflet-1.0.1/proj4leaflet.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/leaflet-binding-2.1.1/leaflet.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/datatables-binding-0.27/datatables.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/dt-core-1.12.1/js/jquery.dataTables.min.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/crosstalk-1.2.0/js/crosstalk.min.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/proj4js-2.3.15/proj4.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/highcharts.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/highcharts-3d.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/highcharts-more.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/modules/stock.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/modules/map.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/modules/data.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/modules/exporting.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/modules/offline-exporting.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/modules/drilldown.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/modules/item-series.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/modules/overlapping-datalabels.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/modules/annotations.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/modules/export-data.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/modules/funnel.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/modules/heatmap.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/modules/treemap.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/modules/sankey.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/modules/dependency-wheel.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/modules/organization.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/modules/solid-gauge.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/modules/streamgraph.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/modules/sunburst.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/modules/vector.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/modules/wordcloud.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/modules/xrange.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/modules/tilemap.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/modules/venn.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/modules/gantt.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/modules/timeline.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/modules/parallel-coordinates.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/modules/bullet.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/modules/coloraxis.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/modules/dumbbell.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/modules/lollipop.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/modules/series-label.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/plugins/motion.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/custom/reset.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highcharts-9.3.1/modules/boost.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/highchart-binding-0.9.4/highchart.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/d3-3.5.5/d3.min.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/d3-hexjson-3.5.5/d3-hexjson.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/hexjsonwidget-binding-0.0.1/hexjsonwidget.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/Leaflet.Sync-0.0.5/L.Map.Sync.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/echarts4r-4.8.0/echarts-en.min.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/echarts4r-4.8.0/ecStat.min.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/echarts4r-4.8.0/dataTool.min.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/echarts4r-binding-0.4.4/echarts4r.js"))
.then(() => loadScript("GoLTC-maps-cartograms-blog-post_files/libs/echarts-gl-1.1.2/echarts-gl.min.js"))
  .then(() => loadScript("./GoLTC-maps-cartograms-blog-post_files/libs/body_script_0.js"))
.then(() => loadScript("./GoLTC-maps-cartograms-blog-post_files/libs/body_script_7.js"))
.then(() => loadScript("./GoLTC-maps-cartograms-blog-post_files/libs/body_script_8.js"))
.then(() => loadScript("./GoLTC-maps-cartograms-blog-post_files/libs/body_script_22.js"))
.then(() => loadScript("./GoLTC-maps-cartograms-blog-post_files/libs/quarto-html-after-body.js"))
  .then(() => window.mermaid.init())
  .then(() => window.HTMLWidgets.staticRender());
  </script></head>
<body>
<header class="quarto-title-block default toc-left page-columns page-full" id="title-block-header">
<div class="quarto-title-banner page-columns page-full">
<div class="quarto-title column-body">
<h1 class="title">Communicating the findings of long-term care research</h1>
<p class="subtitle lead">Interactive maps and cartograms with R and Javascript</p>
<div class="quarto-categories">
<div class="quarto-category">maps</div>
<div class="quarto-category">R</div>
<div class="quarto-category">javascript</div>
<div class="quarto-category">geospatial</div>
<div class="quarto-category">data visualisation</div>
</div>
</div>
</div>
<div class="quarto-title-meta">
<div>
<div class="quarto-title-meta-heading">Author</div>
<div class="quarto-title-meta-contents">
<p>Sam Rickman </p>
</div>
</div>
<div>
<div class="quarto-title-meta-heading">Published</div>
<div class="quarto-title-meta-contents">
<p class="date">14th November 2023</p>
</div>
</div>
</div>
</header><div class="page-columns page-rows-contents page-layout-article toc-left" id="quarto-content">
<div class="sidebar toc-left" id="quarto-sidebar-toc-left">
<nav class="toc-active" data-toc-expanded="99" id="TOC" role="doc-toc">
<h2 id="toc-title">Contents</h2>
<ul>
<li><a class="nav-link active" data-scroll-target="#select-the-data" href="#select-the-data" id="toc-select-the-data">Select the data</a>
<ul class="collapse">
<li><a class="nav-link" data-scroll-target="#explore-the-data" href="#explore-the-data" id="toc-explore-the-data">Explore the data</a></li>
</ul></li>
<li><a class="nav-link" data-scroll-target="#geographic-map-of-deprivation-by-local-authority" href="#geographic-map-of-deprivation-by-local-authority" id="toc-geographic-map-of-deprivation-by-local-authority">Geographic map of deprivation by local authority</a></li>
<li><a class="nav-link" data-scroll-target="#from-maps-to-cartograms" href="#from-maps-to-cartograms" id="toc-from-maps-to-cartograms">From maps to cartograms</a>
<ul class="collapse">
<li><a class="nav-link" data-scroll-target="#hex-cartograms" href="#hex-cartograms" id="toc-hex-cartograms">Hex cartograms</a></li>
<li><a class="nav-link" data-scroll-target="#contiguous-and-non-contiguous-cartograms" href="#contiguous-and-non-contiguous-cartograms" id="toc-contiguous-and-non-contiguous-cartograms">Contiguous and non-contiguous cartograms</a></li>
</ul></li>
<li><a class="nav-link" data-scroll-target="#facet-maps" href="#facet-maps" id="toc-facet-maps">Facet maps</a></li>
<li><a class="nav-link" data-scroll-target="#are-3d-maps-the-answer" href="#are-3d-maps-the-answer" id="toc-are-3d-maps-the-answer">Are 3d maps the answer?</a></li>
<li><a class="nav-link" data-scroll-target="#dorling-cartograms" href="#dorling-cartograms" id="toc-dorling-cartograms">Dorling cartograms</a></li>
<li><a class="nav-link" data-scroll-target="#which-map-is-best" href="#which-map-is-best" id="toc-which-map-is-best">Which map is best?</a>
<ul class="collapse">
<li><a class="nav-link" data-scroll-target="#a-note-on-reproducibility" href="#a-note-on-reproducibility" id="toc-a-note-on-reproducibility">A note on reproducibility</a></li>
</ul></li>
</ul>
</nav>
</div>
<div class="sidebar margin-sidebar" id="quarto-margin-sidebar">
</div>
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">
<div class="cell">
<style type="text/css">
.leaflet-control-layers { visibility: hidden; }
.leaflet-container { background: none; }
[id^=leafletBlack] { background: black !important;}

.vertical-center {
  margin: 0;
  position: sticky;
  top: 50%;
  transform: translateY(-50%);
}
.eden {
    border-color: #00ff00;
    border-style: solid; 
    border-width: 2px;
}
.barnet {
    border-color: #ff01fb;
    border-style: solid; 
    border-width: 2px;
}
.birmingham {
    border-color: #00e1ff;
    border-style: solid; 
    border-width: 2px;    
}
.smaller {
    font-size: 14px;
}
.quarto-title-banner {
    background: #ecf4fc;
}                          
</style>
</div>

<div class="cell column-screen quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="us_polygons" style="width:100%;height:464px;"></div>
<script data-for="us_polygons" type="application/json"></script>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="cart_dorling" style="width:100%;height:464px;"></div>
<script data-for="cart_dorling" type="application/json"></script>
</div>
</div>
</div>
<p class="page-columns page-full"><span class="column-screen" style="font-weight: bold; text-align: center">Map (left) and population-weighted Dorling cartogram (right) of county level US 2020 presidential election results</span></p>
<p>Interactive maps can be a compelling and intuitive way to display geographic variation in your data. But presenting data visually means making choices. The two visualisations above of the 2020 US presidential election results show the difference such choices can make.</p>
<!--
Making maps involves trade-offs. For example, map area bias is a well-known concern, with the US election map a classic example. [@dougherty2021hands] The map on the left is geographically accurate, but gives more visual weight to larger areas. The cartogram on the reflects population by drawing each county as a circle with a radius proportional to its population. However, this sacrifices some geographical accuracy: New York is so populous that some of its counties appear over the Atlantic Ocean. 
-->
<div class="no-row-height column-margin column-container"><div class="callout callout-style-default callout-note callout-titled">
<div aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout" class="callout-header d-flex align-content-center" data-bs-target=".callout-1-contents" data-bs-toggle="collapse">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
About these US election maps
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div class="callout-1-contents callout-collapse collapse" id="callout-1">
<div class="callout-body-container callout-body">
<div class="smaller">
<p>The US map, like everything in this document, was generated with open source data and software. The election data can be found <a href="https://github.com/tonmcg/US_County_Level_Election_Results_08-20/">here</a>. The maps were generated by the author using the <code>cartogram</code> and <code>leaflet</code> R packages, using methods described in this document. You can find the code in the <a href="https://github.com/samrickman/goltc-dsn-maps-cartograms-blog#creating-interactive-maps-and-cartograms-with-r-and-javascript">github repospitory</a>.</p>
</div>
</div>
</div>
</div><div class="callout callout-style-default callout-tip callout-titled" title="What is a cartogram?">
<div aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout" class="callout-header d-flex align-content-center" data-bs-target=".callout-2-contents" data-bs-toggle="collapse">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
What is a cartogram?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div class="callout-2-contents callout-collapse collapse" id="callout-2">
<div class="callout-body-container callout-body">
<div class="smaller">
<blockquote class="blockquote">
<p><a href="http://www.ncgia.ucsb.edu/projects/Cartogram_Central/types.html">Cartograms</a> combine statistical and geographical information in thematic maps, where areas of geographical regions (e.g., countries, states) are scaled in proportion to some statistic (e.g., population, income).<span class="citation" data-cites="nusrat2016state"><sup><a href="#ref-nusrat2016state" role="doc-biblioref">1</a></sup></span></p>
</blockquote>
</div>
</div>
</div>
</div></div>
<p>In long-term care, spending or demographic information is reported at the administrative level. This blog post sets out practical ways to make make maps and cartograms using <a href="https://www.r-project.org/about.html">R</a> and <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Language_overview">JavaScript</a>, highlighting benefits and drawbacks of competing approaches. The code is included within the post and can also be downloaded from the <a href="https://github.com/samrickman/goltc-dsn-maps-cartograms-blog">github repo</a>.</p>
<section class="level1 page-columns page-full" id="select-the-data">
<h1>Select the data</h1>
<p>I will use the <a href="https://opendatacommunities.org/resource?uri=http%3A%2F%2Fopendatacommunities.org%2Fdef%2Fconcept%2Fgeneral-concepts%2Fimd%2Fidaopi">Income Deprivation Affecting Older People Index</a> (IADOPI) as an example dataset. This is an index published by the UK Office of National Statistics which measures the proportion of those aged 60 or over who experience income deprivation.</p>
<p>Each local authority has a score, which is the proportion of people experiencing deprivation. In the most deprived local authority (ranked 1), Tower Hamlets, 43.9% of older adults experience income deprivation. In the least deprived authority (ranked 317), the figure is 5%.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Long code blocks are folded
</div>
</div>
<div class="callout-body-container callout-body">
<p>You can click to expand the folded code blocks in this document.</p>
</div>
</div>
<div class="cell">
<details>
<summary>Show the data loading code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a aria-hidden="true" href="#cb1-1" tabindex="-1"></a><span class="co"># LAD IMD https://www.gov.uk/government/statistics/english-indices-of-deprivation-2019</span></span>
<span id="cb1-2"><a aria-hidden="true" href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb1-3"><a aria-hidden="true" href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-4"><a aria-hidden="true" href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-5"><a aria-hidden="true" href="#cb1-5" tabindex="-1"></a></span>
<span id="cb1-6"><a aria-hidden="true" href="#cb1-6" tabindex="-1"></a>download_data <span class="ot">&lt;-</span> <span class="cf">function</span>(url, <span class="at">out_dir =</span> <span class="st">"./raw_data/"</span>) {</span>
<span id="cb1-7"><a aria-hidden="true" href="#cb1-7" tabindex="-1"></a>    out_file <span class="ot">&lt;-</span> <span class="fu">paste0</span>(out_dir, <span class="fu">basename</span>(url))</span>
<span id="cb1-8"><a aria-hidden="true" href="#cb1-8" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(out_file)) {</span>
<span id="cb1-9"><a aria-hidden="true" href="#cb1-9" tabindex="-1"></a>        <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(out_dir)) <span class="fu">dir.create</span>(out_dir, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-10"><a aria-hidden="true" href="#cb1-10" tabindex="-1"></a>        <span class="fu">download.file</span>(url, out_file)</span>
<span id="cb1-11"><a aria-hidden="true" href="#cb1-11" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb1-12"><a aria-hidden="true" href="#cb1-12" tabindex="-1"></a>        <span class="fu">message</span>(<span class="st">"File already exists: "</span>, out_file)</span>
<span id="cb1-13"><a aria-hidden="true" href="#cb1-13" tabindex="-1"></a>    }</span>
<span id="cb1-14"><a aria-hidden="true" href="#cb1-14" tabindex="-1"></a>    <span class="fu">return</span>(out_file)</span>
<span id="cb1-15"><a aria-hidden="true" href="#cb1-15" tabindex="-1"></a>}</span>
<span id="cb1-16"><a aria-hidden="true" href="#cb1-16" tabindex="-1"></a></span>
<span id="cb1-17"><a aria-hidden="true" href="#cb1-17" tabindex="-1"></a>load_imd <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">imd_url =</span> <span class="st">"https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/833995/File_10_-_IoD2019_Local_Authority_District_Summaries__lower-tier__.xlsx"</span>) {</span>
<span id="cb1-18"><a aria-hidden="true" href="#cb1-18" tabindex="-1"></a>    <span class="co"># From: https://www.gov.uk/government/statistics/english-indices-of-deprivation-2019</span></span>
<span id="cb1-19"><a aria-hidden="true" href="#cb1-19" tabindex="-1"></a>    imd <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(</span>
<span id="cb1-20"><a aria-hidden="true" href="#cb1-20" tabindex="-1"></a>        <span class="fu">download_data</span>(imd_url),</span>
<span id="cb1-21"><a aria-hidden="true" href="#cb1-21" tabindex="-1"></a>        <span class="at">sheet =</span> <span class="st">"IDAOPI"</span></span>
<span id="cb1-22"><a aria-hidden="true" href="#cb1-22" tabindex="-1"></a>    )</span>
<span id="cb1-23"><a aria-hidden="true" href="#cb1-23" tabindex="-1"></a>    <span class="fu">names</span>(imd) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">W+"</span>, <span class="st">""</span>, <span class="fu">names</span>(imd)))</span>
<span id="cb1-24"><a aria-hidden="true" href="#cb1-24" tabindex="-1"></a></span>
<span id="cb1-25"><a aria-hidden="true" href="#cb1-25" tabindex="-1"></a>    imd <span class="sc">|&gt;</span></span>
<span id="cb1-26"><a aria-hidden="true" href="#cb1-26" tabindex="-1"></a>        <span class="fu">select</span>(</span>
<span id="cb1-27"><a aria-hidden="true" href="#cb1-27" tabindex="-1"></a>            <span class="at">lacode =</span> localauthoritydistrictcode2019,</span>
<span id="cb1-28"><a aria-hidden="true" href="#cb1-28" tabindex="-1"></a>            <span class="at">laname =</span> localauthoritydistrictname2019,</span>
<span id="cb1-29"><a aria-hidden="true" href="#cb1-29" tabindex="-1"></a>            <span class="at">imdrank =</span> idaopirankofaveragescore,</span>
<span id="cb1-30"><a aria-hidden="true" href="#cb1-30" tabindex="-1"></a>            <span class="at">imdscore =</span> idaopiaveragescore</span>
<span id="cb1-31"><a aria-hidden="true" href="#cb1-31" tabindex="-1"></a>        )</span>
<span id="cb1-32"><a aria-hidden="true" href="#cb1-32" tabindex="-1"></a>}</span>
<span id="cb1-33"><a aria-hidden="true" href="#cb1-33" tabindex="-1"></a></span>
<span id="cb1-34"><a aria-hidden="true" href="#cb1-34" tabindex="-1"></a></span>
<span id="cb1-35"><a aria-hidden="true" href="#cb1-35" tabindex="-1"></a><span class="co"># Downloaded from https://geoportal.statistics.gov.uk/datasets/ff261db594dd4ed8841e5ed5092553bc/explore?location=55.216245%2C-3.316331%2C6.44</span></span>
<span id="cb1-36"><a aria-hidden="true" href="#cb1-36" tabindex="-1"></a>load_eng_shp <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">in_file =</span> <span class="st">"./raw_data/lad2019shp.zip"</span>) {</span>
<span id="cb1-37"><a aria-hidden="true" href="#cb1-37" tabindex="-1"></a>    shp_file <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">.shp$"</span>, <span class="fu">unzip</span>(in_file, <span class="at">list =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>Name, <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-38"><a aria-hidden="true" href="#cb1-38" tabindex="-1"></a>    shp_full_path <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">dirname</span>(in_file), <span class="st">"/"</span>, shp_file)</span>
<span id="cb1-39"><a aria-hidden="true" href="#cb1-39" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(shp_full_path)) {</span>
<span id="cb1-40"><a aria-hidden="true" href="#cb1-40" tabindex="-1"></a>        <span class="fu">message</span>(<span class="st">"Unzipping shapefile..."</span>)</span>
<span id="cb1-41"><a aria-hidden="true" href="#cb1-41" tabindex="-1"></a>        <span class="fu">unzip</span>(in_file, <span class="at">exdir =</span> <span class="fu">dirname</span>(in_file))</span>
<span id="cb1-42"><a aria-hidden="true" href="#cb1-42" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb1-43"><a aria-hidden="true" href="#cb1-43" tabindex="-1"></a>        <span class="fu">message</span>(<span class="st">"Shapefile already unzipped"</span>)</span>
<span id="cb1-44"><a aria-hidden="true" href="#cb1-44" tabindex="-1"></a>    }</span>
<span id="cb1-45"><a aria-hidden="true" href="#cb1-45" tabindex="-1"></a>    uk <span class="ot">&lt;-</span> <span class="fu">st_read</span>(shp_full_path, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-46"><a aria-hidden="true" href="#cb1-46" tabindex="-1"></a>    eng <span class="ot">&lt;-</span> uk <span class="sc">|&gt;</span></span>
<span id="cb1-47"><a aria-hidden="true" href="#cb1-47" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="fu">startsWith</span>(lad19cd, <span class="st">"E"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb1-48"><a aria-hidden="true" href="#cb1-48" tabindex="-1"></a>        <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="st">"EPSG:4326"</span>)</span>
<span id="cb1-49"><a aria-hidden="true" href="#cb1-49" tabindex="-1"></a>}</span>
<span id="cb1-50"><a aria-hidden="true" href="#cb1-50" tabindex="-1"></a></span>
<span id="cb1-51"><a aria-hidden="true" href="#cb1-51" tabindex="-1"></a><span class="co"># idaopi 60+ https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/833947/IoD2019_Research_Report.pdf</span></span>
<span id="cb1-52"><a aria-hidden="true" href="#cb1-52" tabindex="-1"></a></span>
<span id="cb1-53"><a aria-hidden="true" href="#cb1-53" tabindex="-1"></a>load_pop <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">pop_file =</span> <span class="st">"https://www.ons.gov.uk/file?uri=/peoplepopulationandcommunity/populationandmigration/populationestimates/datasets/populationestimatesforukenglandandwalesscotlandandnorthernireland/mid2019april2019localauthoritydistrictcodes/ukmidyearestimates20192019ladcodes.xls"</span>) {</span>
<span id="cb1-54"><a aria-hidden="true" href="#cb1-54" tabindex="-1"></a>    <span class="co"># https://www.ons.gov.uk/peoplepopulationandcommunity/populationandmigration/populationestimates/datasets/lowersuperoutputareamidyearpopulationestimates</span></span>
<span id="cb1-55"><a aria-hidden="true" href="#cb1-55" tabindex="-1"></a>    pop <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(</span>
<span id="cb1-56"><a aria-hidden="true" href="#cb1-56" tabindex="-1"></a>        <span class="at">path =</span> <span class="fu">download_data</span>(pop_file),</span>
<span id="cb1-57"><a aria-hidden="true" href="#cb1-57" tabindex="-1"></a>        <span class="at">sheet =</span> <span class="st">"MYE2 - Persons"</span>,</span>
<span id="cb1-58"><a aria-hidden="true" href="#cb1-58" tabindex="-1"></a>        <span class="at">skip =</span> <span class="dv">4</span></span>
<span id="cb1-59"><a aria-hidden="true" href="#cb1-59" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb1-60"><a aria-hidden="true" href="#cb1-60" tabindex="-1"></a>        <span class="fu">group_by</span>(<span class="at">lad19cd =</span> Code) <span class="sc">|&gt;</span></span>
<span id="cb1-61"><a aria-hidden="true" href="#cb1-61" tabindex="-1"></a>        <span class="fu">transmute</span>(</span>
<span id="cb1-62"><a aria-hidden="true" href="#cb1-62" tabindex="-1"></a>            <span class="at">pop_all =</span> <span class="fu">sum</span>(<span class="fu">c_across</span>(<span class="st">`</span><span class="at">0</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">90+</span><span class="st">`</span>)),</span>
<span id="cb1-63"><a aria-hidden="true" href="#cb1-63" tabindex="-1"></a>            <span class="at">pop60 =</span> <span class="fu">sum</span>(<span class="fu">sum</span>(<span class="fu">c_across</span>(<span class="st">`</span><span class="at">60</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">90+</span><span class="st">`</span>)))</span>
<span id="cb1-64"><a aria-hidden="true" href="#cb1-64" tabindex="-1"></a>        )</span>
<span id="cb1-65"><a aria-hidden="true" href="#cb1-65" tabindex="-1"></a>}</span>
<span id="cb1-66"><a aria-hidden="true" href="#cb1-66" tabindex="-1"></a></span>
<span id="cb1-67"><a aria-hidden="true" href="#cb1-67" tabindex="-1"></a></span>
<span id="cb1-68"><a aria-hidden="true" href="#cb1-68" tabindex="-1"></a>get_regions_lookup <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">regions_lookup_url =</span> <span class="st">"https://www.ons.gov.uk/file?uri=/peoplepopulationandcommunity/populationandmigration/migrationwithintheuk/datasets/userinformationenglandandwaleslocalauthoritytoregionlookup/june20182019laboundaries/lasregionew2019.xlsx"</span>) {</span>
<span id="cb1-69"><a aria-hidden="true" href="#cb1-69" tabindex="-1"></a>    <span class="co"># From https://www.ons.gov.uk/peoplepopulationandcommunity/populationandmigration/migrationwithintheuk/datasets/userinformationenglandandwaleslocalauthoritytoregionlookup</span></span>
<span id="cb1-70"><a aria-hidden="true" href="#cb1-70" tabindex="-1"></a>    regions_lookup <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="fu">download_data</span>(regions_lookup_url), <span class="at">skip =</span> <span class="dv">4</span>)</span>
<span id="cb1-71"><a aria-hidden="true" href="#cb1-71" tabindex="-1"></a>    <span class="fu">names</span>(regions_lookup) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">W+"</span>, <span class="st">""</span>, <span class="fu">names</span>(regions_lookup)))</span>
<span id="cb1-72"><a aria-hidden="true" href="#cb1-72" tabindex="-1"></a>    regions_lookup</span>
<span id="cb1-73"><a aria-hidden="true" href="#cb1-73" tabindex="-1"></a>}</span>
<span id="cb1-74"><a aria-hidden="true" href="#cb1-74" tabindex="-1"></a></span>
<span id="cb1-75"><a aria-hidden="true" href="#cb1-75" tabindex="-1"></a>create_eng_imd_dataset <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">lads_to_highlight =</span> <span class="fu">c</span>(</span>
<span id="cb1-76"><a aria-hidden="true" href="#cb1-76" tabindex="-1"></a>                                       <span class="st">"Eden"</span> <span class="ot">=</span> <span class="st">"#00ff00"</span>,</span>
<span id="cb1-77"><a aria-hidden="true" href="#cb1-77" tabindex="-1"></a>                                       <span class="st">"Barnet"</span> <span class="ot">=</span> <span class="st">"#ff01fb"</span>,</span>
<span id="cb1-78"><a aria-hidden="true" href="#cb1-78" tabindex="-1"></a>                                       <span class="st">"Birmingham"</span> <span class="ot">=</span> <span class="st">"#00e1ff"</span></span>
<span id="cb1-79"><a aria-hidden="true" href="#cb1-79" tabindex="-1"></a>                                   ), <span class="at">color_scale =</span> <span class="st">"YlOrRd"</span>, <span class="at">scale_steps =</span> <span class="dv">9</span>) {</span>
<span id="cb1-80"><a aria-hidden="true" href="#cb1-80" tabindex="-1"></a>    imd <span class="ot">&lt;-</span> <span class="fu">load_imd</span>()</span>
<span id="cb1-81"><a aria-hidden="true" href="#cb1-81" tabindex="-1"></a>    pop <span class="ot">&lt;-</span> <span class="fu">load_pop</span>()</span>
<span id="cb1-82"><a aria-hidden="true" href="#cb1-82" tabindex="-1"></a>    regions_lookup <span class="ot">&lt;-</span> <span class="fu">get_regions_lookup</span>()</span>
<span id="cb1-83"><a aria-hidden="true" href="#cb1-83" tabindex="-1"></a>    eng <span class="ot">&lt;-</span> <span class="fu">load_eng_shp</span>()</span>
<span id="cb1-84"><a aria-hidden="true" href="#cb1-84" tabindex="-1"></a>    pal <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">brewer.pal</span>(scale_steps, color_scale))</span>
<span id="cb1-85"><a aria-hidden="true" href="#cb1-85" tabindex="-1"></a></span>
<span id="cb1-86"><a aria-hidden="true" href="#cb1-86" tabindex="-1"></a>    eng <span class="sc">|&gt;</span></span>
<span id="cb1-87"><a aria-hidden="true" href="#cb1-87" tabindex="-1"></a>        <span class="fu">inner_join</span>(imd, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"lad19cd"</span> <span class="ot">=</span> <span class="st">"lacode"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb1-88"><a aria-hidden="true" href="#cb1-88" tabindex="-1"></a>        <span class="fu">inner_join</span>(pop, <span class="at">by =</span> <span class="st">"lad19cd"</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-89"><a aria-hidden="true" href="#cb1-89" tabindex="-1"></a>        <span class="fu">inner_join</span>(regions_lookup, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"lad19cd"</span> <span class="ot">=</span> <span class="st">"lacode"</span>, <span class="st">"laname"</span> <span class="ot">=</span> <span class="st">"laname"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb1-90"><a aria-hidden="true" href="#cb1-90" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb1-91"><a aria-hidden="true" href="#cb1-91" tabindex="-1"></a>            <span class="at">color =</span> <span class="fu">rev</span>(<span class="fu">pal</span>(<span class="fu">n</span>()))[imdrank],</span>
<span id="cb1-92"><a aria-hidden="true" href="#cb1-92" tabindex="-1"></a>            <span class="at">label =</span> <span class="fu">paste0</span>(</span>
<span id="cb1-93"><a aria-hidden="true" href="#cb1-93" tabindex="-1"></a>                <span class="st">"&lt;b&gt;"</span>, laname, <span class="st">"&lt;/b&gt;&lt;br&gt;"</span>,</span>
<span id="cb1-94"><a aria-hidden="true" href="#cb1-94" tabindex="-1"></a>                <span class="st">"Rank: "</span>, imdrank, <span class="st">"&lt;br&gt;"</span>,</span>
<span id="cb1-95"><a aria-hidden="true" href="#cb1-95" tabindex="-1"></a>                <span class="st">"Score: "</span>, imdscore, <span class="st">"&lt;br&gt;"</span>,</span>
<span id="cb1-96"><a aria-hidden="true" href="#cb1-96" tabindex="-1"></a>                <span class="st">"Older pop: "</span>, <span class="fu">paste0</span>(<span class="fu">round</span>(pop60 <span class="sc">/</span> <span class="fl">1e3</span>), <span class="st">"k"</span>)</span>
<span id="cb1-97"><a aria-hidden="true" href="#cb1-97" tabindex="-1"></a>            ),</span>
<span id="cb1-98"><a aria-hidden="true" href="#cb1-98" tabindex="-1"></a>            <span class="at">highlight =</span> lad19nm <span class="sc">%in%</span> <span class="fu">names</span>(lads_to_highlight),</span>
<span id="cb1-99"><a aria-hidden="true" href="#cb1-99" tabindex="-1"></a>            <span class="at">highlight_color =</span> <span class="fu">ifelse</span>(highlight, lads_to_highlight[lad19nm], <span class="st">"black"</span>)</span>
<span id="cb1-100"><a aria-hidden="true" href="#cb1-100" tabindex="-1"></a>        )</span>
<span id="cb1-101"><a aria-hidden="true" href="#cb1-101" tabindex="-1"></a>}</span>
<span id="cb1-102"><a aria-hidden="true" href="#cb1-102" tabindex="-1"></a></span>
<span id="cb1-103"><a aria-hidden="true" href="#cb1-103" tabindex="-1"></a><span class="co"># This is the dataset we'll use throughout the document</span></span>
<span id="cb1-104"><a aria-hidden="true" href="#cb1-104" tabindex="-1"></a>eng <span class="ot">&lt;-</span> <span class="fu">create_eng_imd_dataset</span>()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-76dc5aad5e2079b3771a" style="width:100%;height:auto;"></div>
<script data-for="htmlwidget-76dc5aad5e2079b3771a" type="application/json"></script>
</div>
</div>
<section class="level2 page-columns page-full" id="explore-the-data">
<h2 class="anchored" data-anchor-id="explore-the-data">Explore the data</h2>
<div class="cell page-columns page-full">
<details>
<summary>Code for the plot in the margin</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a aria-hidden="true" href="#cb2-1" tabindex="-1"></a><span class="fu">library</span>(highcharter)</span>
<span id="cb2-2"><a aria-hidden="true" href="#cb2-2" tabindex="-1"></a>draw_bar_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, var, <span class="at">chart_type =</span> <span class="st">"chart"</span>,</span>
<span id="cb2-3"><a aria-hidden="true" href="#cb2-3" tabindex="-1"></a>                          <span class="at">series_type =</span> <span class="st">"column"</span>,</span>
<span id="cb2-4"><a aria-hidden="true" href="#cb2-4" tabindex="-1"></a>                          series_name,</span>
<span id="cb2-5"><a aria-hidden="true" href="#cb2-5" tabindex="-1"></a>                          xlab, ylab,</span>
<span id="cb2-6"><a aria-hidden="true" href="#cb2-6" tabindex="-1"></a>                          plot_title) {</span>
<span id="cb2-7"><a aria-hidden="true" href="#cb2-7" tabindex="-1"></a>    plot_df <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span></span>
<span id="cb2-8"><a aria-hidden="true" href="#cb2-8" tabindex="-1"></a>        <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb2-9"><a aria-hidden="true" href="#cb2-9" tabindex="-1"></a>        <span class="fu">arrange</span>({{ var }}) <span class="sc">|&gt;</span></span>
<span id="cb2-10"><a aria-hidden="true" href="#cb2-10" tabindex="-1"></a>        <span class="fu">rename</span>(<span class="at">var =</span> {{ var }})</span>
<span id="cb2-11"><a aria-hidden="true" href="#cb2-11" tabindex="-1"></a></span>
<span id="cb2-12"><a aria-hidden="true" href="#cb2-12" tabindex="-1"></a>    <span class="fu">highchart</span>(<span class="at">type =</span> chart_type) <span class="sc">|&gt;</span></span>
<span id="cb2-13"><a aria-hidden="true" href="#cb2-13" tabindex="-1"></a>        <span class="fu">hc_add_series</span>(</span>
<span id="cb2-14"><a aria-hidden="true" href="#cb2-14" tabindex="-1"></a>            <span class="at">name =</span> series_name,</span>
<span id="cb2-15"><a aria-hidden="true" href="#cb2-15" tabindex="-1"></a>            <span class="at">type =</span> series_type,</span>
<span id="cb2-16"><a aria-hidden="true" href="#cb2-16" tabindex="-1"></a>            <span class="at">data =</span> plot_df,</span>
<span id="cb2-17"><a aria-hidden="true" href="#cb2-17" tabindex="-1"></a>            <span class="fu">hcaes</span>(</span>
<span id="cb2-18"><a aria-hidden="true" href="#cb2-18" tabindex="-1"></a>                <span class="at">x =</span> lad19nm,</span>
<span id="cb2-19"><a aria-hidden="true" href="#cb2-19" tabindex="-1"></a>                <span class="at">y =</span> var,</span>
<span id="cb2-20"><a aria-hidden="true" href="#cb2-20" tabindex="-1"></a>            ),</span>
<span id="cb2-21"><a aria-hidden="true" href="#cb2-21" tabindex="-1"></a>            <span class="at">showInLegend =</span> <span class="cn">FALSE</span></span>
<span id="cb2-22"><a aria-hidden="true" href="#cb2-22" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb2-23"><a aria-hidden="true" href="#cb2-23" tabindex="-1"></a>        <span class="fu">hc_xAxis</span>(</span>
<span id="cb2-24"><a aria-hidden="true" href="#cb2-24" tabindex="-1"></a>            <span class="at">title =</span> <span class="fu">list</span>(<span class="at">text =</span> xlab),</span>
<span id="cb2-25"><a aria-hidden="true" href="#cb2-25" tabindex="-1"></a>            <span class="at">labels =</span> <span class="fu">list</span>(<span class="at">enabled =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-26"><a aria-hidden="true" href="#cb2-26" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb2-27"><a aria-hidden="true" href="#cb2-27" tabindex="-1"></a>        <span class="fu">hc_yAxis</span>(</span>
<span id="cb2-28"><a aria-hidden="true" href="#cb2-28" tabindex="-1"></a>            <span class="at">title =</span> <span class="fu">list</span>(<span class="at">text =</span> ylab)</span>
<span id="cb2-29"><a aria-hidden="true" href="#cb2-29" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb2-30"><a aria-hidden="true" href="#cb2-30" tabindex="-1"></a>        <span class="fu">hc_title</span>(<span class="at">text =</span> plot_title)</span>
<span id="cb2-31"><a aria-hidden="true" href="#cb2-31" tabindex="-1"></a>}</span>
<span id="cb2-32"><a aria-hidden="true" href="#cb2-32" tabindex="-1"></a></span>
<span id="cb2-33"><a aria-hidden="true" href="#cb2-33" tabindex="-1"></a></span>
<span id="cb2-34"><a aria-hidden="true" href="#cb2-34" tabindex="-1"></a><span class="fu">draw_bar_plot</span>(eng, imdscore,</span>
<span id="cb2-35"><a aria-hidden="true" href="#cb2-35" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">"Local authorities (sorted by proportion experiencing deprivation)"</span>,</span>
<span id="cb2-36"><a aria-hidden="true" href="#cb2-36" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">"Proportion of older people experiencing deprivation"</span>,</span>
<span id="cb2-37"><a aria-hidden="true" href="#cb2-37" tabindex="-1"></a>    <span class="at">plot_title =</span> <span class="st">"Distribution of proportion of adults experiencing deprivation"</span>,</span>
<span id="cb2-38"><a aria-hidden="true" href="#cb2-38" tabindex="-1"></a>    <span class="at">series_name =</span> <span class="st">"IADOPI score"</span></span>
<span id="cb2-39"><a aria-hidden="true" href="#cb2-39" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</details>
<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div class="highchart html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-5703bbc8ee2887e83d10" style="width:100%;height:464px;"></div>
<script data-for="htmlwidget-5703bbc8ee2887e83d10" type="application/json"></script>
</div></div></div>
<p>The bar plot in the margin shows the wide range in the distribution. While a bar plot gives a sense of the overall picture, it is not useful for finding specific areas, or comparing between regions. Let’s make some maps!</p>
</section>
</section>
<section class="level1 page-columns page-full" id="geographic-map-of-deprivation-by-local-authority">
<h1>Geographic map of deprivation by local authority</h1>
<p>We can use the R <a href="https://rstudio.github.io/leaflet/"><code>leaflet</code></a> package, which is a wrapper around the open source Javascript library of the same name, to make interactive maps. Such maps are visually appealing and easy to understand, and require very little code.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a aria-hidden="true" href="#cb3-1" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb3-2"><a aria-hidden="true" href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a aria-hidden="true" href="#cb3-3" tabindex="-1"></a><span class="co"># This legend will apply to all maps and cartograms in this post</span></span>
<span id="cb3-4"><a aria-hidden="true" href="#cb3-4" tabindex="-1"></a>create_legend_colors <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, scale_column, <span class="at">n_symbols =</span> <span class="dv">5</span>, <span class="at">color_scale =</span> <span class="st">"YlOrRd"</span>, <span class="at">scale_steps =</span> <span class="dv">9</span>) {</span>
<span id="cb3-5"><a aria-hidden="true" href="#cb3-5" tabindex="-1"></a>    pal <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">brewer.pal</span>(scale_steps, color_scale))</span>
<span id="cb3-6"><a aria-hidden="true" href="#cb3-6" tabindex="-1"></a>    legend_values <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(dat[[scale_column]]), <span class="fu">max</span>(dat[[scale_column]]), <span class="at">length.out =</span> n_symbols)</span>
<span id="cb3-7"><a aria-hidden="true" href="#cb3-7" tabindex="-1"></a>    legend_colors <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">pal</span>(<span class="fu">length</span>(legend_values)))</span>
<span id="cb3-8"><a aria-hidden="true" href="#cb3-8" tabindex="-1"></a>    legend_labels <span class="ot">&lt;-</span> legend_values</span>
<span id="cb3-9"><a aria-hidden="true" href="#cb3-9" tabindex="-1"></a>    legend_labels[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">paste</span>(legend_labels[<span class="dv">1</span>], <span class="st">"(most)"</span>)</span>
<span id="cb3-10"><a aria-hidden="true" href="#cb3-10" tabindex="-1"></a>    legend_labels[n_symbols] <span class="ot">&lt;-</span> <span class="fu">paste</span>(legend_labels[n_symbols], <span class="st">"(least)"</span>)</span>
<span id="cb3-11"><a aria-hidden="true" href="#cb3-11" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb3-12"><a aria-hidden="true" href="#cb3-12" tabindex="-1"></a>        <span class="at">legend_colors =</span> legend_colors,</span>
<span id="cb3-13"><a aria-hidden="true" href="#cb3-13" tabindex="-1"></a>        <span class="at">legend_labels =</span> legend_labels</span>
<span id="cb3-14"><a aria-hidden="true" href="#cb3-14" tabindex="-1"></a>    )</span>
<span id="cb3-15"><a aria-hidden="true" href="#cb3-15" tabindex="-1"></a>}</span>
<span id="cb3-16"><a aria-hidden="true" href="#cb3-16" tabindex="-1"></a></span>
<span id="cb3-17"><a aria-hidden="true" href="#cb3-17" tabindex="-1"></a><span class="co"># Function to generate the Leaflet maps in this post</span></span>
<span id="cb3-18"><a aria-hidden="true" href="#cb3-18" tabindex="-1"></a>create_map <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, elementId, <span class="at">second_legend =</span> <span class="cn">FALSE</span>, <span class="at">remove_top_left_legend =</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-19"><a aria-hidden="true" href="#cb3-19" tabindex="-1"></a>                       <span class="at">legend_colors =</span> legend<span class="sc">$</span>legend_colors, <span class="at">legend_labels =</span> legend<span class="sc">$</span>legend_labels,</span>
<span id="cb3-20"><a aria-hidden="true" href="#cb3-20" tabindex="-1"></a>                       <span class="at">legend_title =</span> <span class="st">"Rank"</span>, <span class="at">add_tiles =</span> <span class="cn">FALSE</span>, <span class="at">zoom =</span> <span class="fl">6.2</span>, <span class="at">base_boundaries =</span> <span class="cn">NULL</span>) {</span>
<span id="cb3-21"><a aria-hidden="true" href="#cb3-21" tabindex="-1"></a>    <span class="co"># Create borders for areas we are highlighting</span></span>
<span id="cb3-22"><a aria-hidden="true" href="#cb3-22" tabindex="-1"></a>    borders <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span></span>
<span id="cb3-23"><a aria-hidden="true" href="#cb3-23" tabindex="-1"></a>        <span class="fu">filter</span>(highlight) <span class="sc">|&gt;</span></span>
<span id="cb3-24"><a aria-hidden="true" href="#cb3-24" tabindex="-1"></a>        <span class="fu">st_transform</span>(<span class="st">"EPSG:4326"</span>)</span>
<span id="cb3-25"><a aria-hidden="true" href="#cb3-25" tabindex="-1"></a></span>
<span id="cb3-26"><a aria-hidden="true" href="#cb3-26" tabindex="-1"></a>    <span class="co"># Base map</span></span>
<span id="cb3-27"><a aria-hidden="true" href="#cb3-27" tabindex="-1"></a>    leaflet_map <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(dat, <span class="st">"EPSG:4326"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-28"><a aria-hidden="true" href="#cb3-28" tabindex="-1"></a>        <span class="fu">leaflet</span>(</span>
<span id="cb3-29"><a aria-hidden="true" href="#cb3-29" tabindex="-1"></a>            <span class="at">options =</span> <span class="fu">leafletOptions</span>(<span class="at">zoomSnap =</span> <span class="fl">0.1</span>, <span class="at">zoomDelta =</span> <span class="fl">0.1</span>),</span>
<span id="cb3-30"><a aria-hidden="true" href="#cb3-30" tabindex="-1"></a>            <span class="at">elementId =</span> elementId</span>
<span id="cb3-31"><a aria-hidden="true" href="#cb3-31" tabindex="-1"></a>        )</span>
<span id="cb3-32"><a aria-hidden="true" href="#cb3-32" tabindex="-1"></a></span>
<span id="cb3-33"><a aria-hidden="true" href="#cb3-33" tabindex="-1"></a>    <span class="co"># Draw all LA boundaries if provided (e.g. in non-contiguous cartogram)</span></span>
<span id="cb3-34"><a aria-hidden="true" href="#cb3-34" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(base_boundaries)) {</span>
<span id="cb3-35"><a aria-hidden="true" href="#cb3-35" tabindex="-1"></a>        leaflet_map <span class="ot">&lt;-</span> leaflet_map <span class="sc">|&gt;</span> <span class="fu">addPolygons</span>(</span>
<span id="cb3-36"><a aria-hidden="true" href="#cb3-36" tabindex="-1"></a>            <span class="at">data =</span> <span class="fu">st_transform</span>(base_boundaries, <span class="st">"EPSG:4326"</span>),</span>
<span id="cb3-37"><a aria-hidden="true" href="#cb3-37" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"white"</span>,</span>
<span id="cb3-38"><a aria-hidden="true" href="#cb3-38" tabindex="-1"></a>            <span class="at">opacity =</span> <span class="dv">1</span>,</span>
<span id="cb3-39"><a aria-hidden="true" href="#cb3-39" tabindex="-1"></a>            <span class="at">fillOpacity =</span> <span class="dv">0</span>,</span>
<span id="cb3-40"><a aria-hidden="true" href="#cb3-40" tabindex="-1"></a>            <span class="at">weight =</span> <span class="fl">0.5</span></span>
<span id="cb3-41"><a aria-hidden="true" href="#cb3-41" tabindex="-1"></a>        )</span>
<span id="cb3-42"><a aria-hidden="true" href="#cb3-42" tabindex="-1"></a>    }</span>
<span id="cb3-43"><a aria-hidden="true" href="#cb3-43" tabindex="-1"></a></span>
<span id="cb3-44"><a aria-hidden="true" href="#cb3-44" tabindex="-1"></a>    leaflet_map <span class="ot">&lt;-</span> leaflet_map <span class="sc">|&gt;</span></span>
<span id="cb3-45"><a aria-hidden="true" href="#cb3-45" tabindex="-1"></a>        <span class="fu">addPolygons</span>(</span>
<span id="cb3-46"><a aria-hidden="true" href="#cb3-46" tabindex="-1"></a>            <span class="at">color =</span> <span class="sc">~</span> <span class="fu">ifelse</span>(highlight, <span class="st">"white"</span>, <span class="st">"black"</span>),</span>
<span id="cb3-47"><a aria-hidden="true" href="#cb3-47" tabindex="-1"></a>            <span class="at">opacity =</span> <span class="sc">~</span> <span class="fu">ifelse</span>(highlight, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb3-48"><a aria-hidden="true" href="#cb3-48" tabindex="-1"></a>            <span class="at">weight =</span> <span class="sc">~</span> <span class="fu">ifelse</span>(highlight, <span class="dv">3</span>, <span class="dv">1</span>),</span>
<span id="cb3-49"><a aria-hidden="true" href="#cb3-49" tabindex="-1"></a>            <span class="at">fillColor =</span> <span class="sc">~</span>color,</span>
<span id="cb3-50"><a aria-hidden="true" href="#cb3-50" tabindex="-1"></a>            <span class="at">fillOpacity =</span> <span class="dv">1</span>,</span>
<span id="cb3-51"><a aria-hidden="true" href="#cb3-51" tabindex="-1"></a>            <span class="at">label =</span> <span class="sc">~</span> <span class="fu">lapply</span>(label, htmltools<span class="sc">::</span>HTML)</span>
<span id="cb3-52"><a aria-hidden="true" href="#cb3-52" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb3-53"><a aria-hidden="true" href="#cb3-53" tabindex="-1"></a>        <span class="fu">addPolygons</span>(</span>
<span id="cb3-54"><a aria-hidden="true" href="#cb3-54" tabindex="-1"></a>            <span class="at">data =</span> borders,</span>
<span id="cb3-55"><a aria-hidden="true" href="#cb3-55" tabindex="-1"></a>            <span class="at">color =</span> <span class="sc">~</span>highlight_color,</span>
<span id="cb3-56"><a aria-hidden="true" href="#cb3-56" tabindex="-1"></a>            <span class="at">opacity =</span> <span class="dv">1</span>,</span>
<span id="cb3-57"><a aria-hidden="true" href="#cb3-57" tabindex="-1"></a>            <span class="at">fillOpacity =</span> <span class="dv">0</span>,</span>
<span id="cb3-58"><a aria-hidden="true" href="#cb3-58" tabindex="-1"></a>            <span class="at">weight =</span> <span class="dv">3</span>,</span>
<span id="cb3-59"><a aria-hidden="true" href="#cb3-59" tabindex="-1"></a>            <span class="at">label =</span> <span class="sc">~</span> <span class="fu">lapply</span>(label, htmltools<span class="sc">::</span>HTML)</span>
<span id="cb3-60"><a aria-hidden="true" href="#cb3-60" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb3-61"><a aria-hidden="true" href="#cb3-61" tabindex="-1"></a>        <span class="fu">setView</span>(<span class="at">lat =</span> <span class="fl">52.901928</span>, <span class="at">lng =</span> <span class="sc">-</span><span class="fl">1.464854</span>, <span class="at">zoom =</span> zoom) <span class="sc">|&gt;</span></span>
<span id="cb3-62"><a aria-hidden="true" href="#cb3-62" tabindex="-1"></a>        <span class="fu">addLegend</span>(</span>
<span id="cb3-63"><a aria-hidden="true" href="#cb3-63" tabindex="-1"></a>            <span class="at">position =</span> <span class="st">"topright"</span>,</span>
<span id="cb3-64"><a aria-hidden="true" href="#cb3-64" tabindex="-1"></a>            <span class="at">title =</span> legend_title,</span>
<span id="cb3-65"><a aria-hidden="true" href="#cb3-65" tabindex="-1"></a>            <span class="at">colors =</span> legend_colors,</span>
<span id="cb3-66"><a aria-hidden="true" href="#cb3-66" tabindex="-1"></a>            <span class="at">labels =</span> legend_labels,</span>
<span id="cb3-67"><a aria-hidden="true" href="#cb3-67" tabindex="-1"></a>            <span class="at">opacity =</span> <span class="dv">1</span></span>
<span id="cb3-68"><a aria-hidden="true" href="#cb3-68" tabindex="-1"></a>        )</span>
<span id="cb3-69"><a aria-hidden="true" href="#cb3-69" tabindex="-1"></a></span>
<span id="cb3-70"><a aria-hidden="true" href="#cb3-70" tabindex="-1"></a>    <span class="cf">if</span> (add_tiles) {</span>
<span id="cb3-71"><a aria-hidden="true" href="#cb3-71" tabindex="-1"></a>        leaflet_map <span class="ot">&lt;-</span> <span class="fu">addTiles</span>(leaflet_map)</span>
<span id="cb3-72"><a aria-hidden="true" href="#cb3-72" tabindex="-1"></a>    }</span>
<span id="cb3-73"><a aria-hidden="true" href="#cb3-73" tabindex="-1"></a></span>
<span id="cb3-74"><a aria-hidden="true" href="#cb3-74" tabindex="-1"></a>    <span class="cf">if</span> (second_legend) {</span>
<span id="cb3-75"><a aria-hidden="true" href="#cb3-75" tabindex="-1"></a>        leaflet_map <span class="ot">&lt;-</span> leaflet_map <span class="sc">|&gt;</span></span>
<span id="cb3-76"><a aria-hidden="true" href="#cb3-76" tabindex="-1"></a>            <span class="fu">addLegend</span>(</span>
<span id="cb3-77"><a aria-hidden="true" href="#cb3-77" tabindex="-1"></a>                <span class="at">position =</span> <span class="st">"bottomleft"</span>,</span>
<span id="cb3-78"><a aria-hidden="true" href="#cb3-78" tabindex="-1"></a>                <span class="at">colors =</span> borders<span class="sc">$</span>highlight_color,</span>
<span id="cb3-79"><a aria-hidden="true" href="#cb3-79" tabindex="-1"></a>                <span class="at">labels =</span> borders<span class="sc">$</span>lad19nm,</span>
<span id="cb3-80"><a aria-hidden="true" href="#cb3-80" tabindex="-1"></a>                <span class="at">layerId =</span> <span class="st">"laColorLegend"</span></span>
<span id="cb3-81"><a aria-hidden="true" href="#cb3-81" tabindex="-1"></a>            )</span>
<span id="cb3-82"><a aria-hidden="true" href="#cb3-82" tabindex="-1"></a>    }</span>
<span id="cb3-83"><a aria-hidden="true" href="#cb3-83" tabindex="-1"></a></span>
<span id="cb3-84"><a aria-hidden="true" href="#cb3-84" tabindex="-1"></a>    <span class="co"># Class name thing to fix leaflet bug</span></span>
<span id="cb3-85"><a aria-hidden="true" href="#cb3-85" tabindex="-1"></a>    <span class="co"># https://github.com/r-tmap/tmap/issues/575</span></span>
<span id="cb3-86"><a aria-hidden="true" href="#cb3-86" tabindex="-1"></a></span>
<span id="cb3-87"><a aria-hidden="true" href="#cb3-87" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span>remove_top_left_legend) {</span>
<span id="cb3-88"><a aria-hidden="true" href="#cb3-88" tabindex="-1"></a>        <span class="fu">return</span>(leaflet_map)</span>
<span id="cb3-89"><a aria-hidden="true" href="#cb3-89" tabindex="-1"></a>    }</span>
<span id="cb3-90"><a aria-hidden="true" href="#cb3-90" tabindex="-1"></a></span>
<span id="cb3-91"><a aria-hidden="true" href="#cb3-91" tabindex="-1"></a>    remove_top_left_js <span class="ot">&lt;-</span> <span class="st">'</span></span>
<span id="cb3-92"><a aria-hidden="true" href="#cb3-92" tabindex="-1"></a><span class="st">    function (el, x) {</span></span>
<span id="cb3-93"><a aria-hidden="true" href="#cb3-93" tabindex="-1"></a><span class="st">        el.getElementsByClassName("leaflet-top leaflet-left")[0].classList.remove("leaflet-top");</span></span>
<span id="cb3-94"><a aria-hidden="true" href="#cb3-94" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb3-95"><a aria-hidden="true" href="#cb3-95" tabindex="-1"></a><span class="st">    '</span></span>
<span id="cb3-96"><a aria-hidden="true" href="#cb3-96" tabindex="-1"></a></span>
<span id="cb3-97"><a aria-hidden="true" href="#cb3-97" tabindex="-1"></a>    leaflet_map <span class="sc">|&gt;</span></span>
<span id="cb3-98"><a aria-hidden="true" href="#cb3-98" tabindex="-1"></a>        htmlwidgets<span class="sc">::</span><span class="fu">onRender</span>(remove_top_left_js)</span>
<span id="cb3-99"><a aria-hidden="true" href="#cb3-99" tabindex="-1"></a>}</span>
<span id="cb3-100"><a aria-hidden="true" href="#cb3-100" tabindex="-1"></a></span>
<span id="cb3-101"><a aria-hidden="true" href="#cb3-101" tabindex="-1"></a>legend <span class="ot">&lt;-</span> <span class="fu">create_legend_colors</span>(eng, <span class="st">"imdrank"</span>)</span>
<span id="cb3-102"><a aria-hidden="true" href="#cb3-102" tabindex="-1"></a><span class="fu">create_map</span>(eng, <span class="st">"leafletStandardMap"</span>, <span class="at">zoom =</span> <span class="fl">6.0</span>, <span class="at">add_tiles =</span> <span class="cn">TRUE</span>, <span class="at">second_legend =</span> <span class="cn">TRUE</span>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="leafletStandardMap" style="width:100%;height:464px;"></div>
<script data-for="leafletStandardMap" type="application/json"></script>
</div>
</div>
<p>Throughout this document I have highlighted three areas with different sizes and population densities:</p>
<div class="no-row-height column-margin column-container"><div class="callout callout-style-default callout-note callout-titled">
<div aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout" class="callout-header d-flex align-content-center" data-bs-target=".callout-4-contents" data-bs-toggle="collapse">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
What does <code>EPSG:4326</code> mean? A note on coordinate reference systems
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div class="callout-4-contents callout-collapse collapse" id="callout-4">
<div class="callout-body-container callout-body">
<div class="smaller">
<p>In the code blocks above, and throughout this document, you will see code like, <code>st_transform(crs = "EPSG:4326")</code>. The <a href="https://r-spatial.github.io/sf/reference/st_transform.html"><code>st_transform()</code></a> function can convert geometry from geographic (latitude/longitude) format to projected (easting/northing) and vice-versa. Many packages for creating maps, such as <code>leaflet</code>, expect input data in lat/lon format. However, packages which conduct geospatial operations, such as calculating centroids or creating cartograms, work with shapes on a 2-dimensional plane. Owing to the ellipsoid shape of the world, the most appropriate transformation differs depending on the area. I use the standard <a href="https://epsg.io/4326">ESPG:4326</a> for lat/lon data, and as this is UK data, the British National Grid <a href="https://epsg.io/27700">ESPG:27700</a> for projected data. For more information, see Chapter 7 of Geocomputation with R: Second Edition<span class="citation" data-cites="lovelace2019geocomputation"><sup><a href="#ref-lovelace2019geocomputation" role="doc-biblioref">2</a></sup></span>, <a href="https://r.geocompx.org/reproj-geo-data">Reprojecting Geographical Data</a>.</p>
</div>
</div>
</div>
</div></div><ol type="1">
<li><span class="eden">Eden</span>: a large, rural area in the North of England with an older population of 18,000.</li>
<li><span class="birmingham">Birmingham</span>: a large city with a population of 198,000, the largest older population of any local authority.</li>
<li><span class="barnet">Barnet</span>: a relatively large London borough, which is still significantly smaller than most non-London local authorities. It has an older population of 76,000.</li>
</ol>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Map area bias
</div>
</div>
<div class="callout-body-container callout-body">
<p>Map area bias is the phenomenon where large, sparsely populated rural areas dominate the map, while smaller, more populous cities are less visible.</p>
</div>
</div>
<p>These areas show some of the benefits and drawbacks of each mapping approach. For example, this map gives the impression that the north of England has significant areas with very low deprivation. Spatially, this is true. However, the region is dominated by large, sparsely populated areas like <span class="eden">Eden</span>. The bar plot below shows that excluding <span style="color: #f45b5b; font-weight: bold;">London</span>, the <span style="color: #2b908f; font-weight: bold;">North East</span> and <span style="color: #e4d353; font-weight: bold;">North West</span> have the highest levels of deprivation.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a aria-hidden="true" href="#cb4-1" tabindex="-1"></a><span class="fu">library</span>(highcharter)</span>
<span id="cb4-2"><a aria-hidden="true" href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a aria-hidden="true" href="#cb4-3" tabindex="-1"></a>create_drilldown_data <span class="ot">&lt;-</span> <span class="cf">function</span>(eng) {</span>
<span id="cb4-4"><a aria-hidden="true" href="#cb4-4" tabindex="-1"></a>    regions_column <span class="ot">&lt;-</span> eng <span class="sc">|&gt;</span></span>
<span id="cb4-5"><a aria-hidden="true" href="#cb4-5" tabindex="-1"></a>        <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb4-6"><a aria-hidden="true" href="#cb4-6" tabindex="-1"></a>        <span class="fu">group_by</span>(regioncode, regionname) <span class="sc">|&gt;</span></span>
<span id="cb4-7"><a aria-hidden="true" href="#cb4-7" tabindex="-1"></a>        <span class="fu">summarise</span>(</span>
<span id="cb4-8"><a aria-hidden="true" href="#cb4-8" tabindex="-1"></a>            <span class="at">imdscore =</span> <span class="fu">weighted.mean</span>(imdscore, <span class="at">w =</span> pop60),</span>
<span id="cb4-9"><a aria-hidden="true" href="#cb4-9" tabindex="-1"></a>            <span class="at">pop60 =</span> <span class="fu">sum</span>(pop60),</span>
<span id="cb4-10"><a aria-hidden="true" href="#cb4-10" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb4-11"><a aria-hidden="true" href="#cb4-11" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb4-12"><a aria-hidden="true" href="#cb4-12" tabindex="-1"></a>        <span class="fu">arrange</span>(imdscore) <span class="sc">|&gt;</span></span>
<span id="cb4-13"><a aria-hidden="true" href="#cb4-13" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb4-14"><a aria-hidden="true" href="#cb4-14" tabindex="-1"></a>            <span class="at">imdrank =</span> <span class="fu">rev</span>(<span class="fu">row_number</span>()),</span>
<span id="cb4-15"><a aria-hidden="true" href="#cb4-15" tabindex="-1"></a>            <span class="at">imdscorepretty =</span> <span class="fu">round</span>(imdscore, <span class="dv">2</span>)</span>
<span id="cb4-16"><a aria-hidden="true" href="#cb4-16" tabindex="-1"></a>        )</span>
<span id="cb4-17"><a aria-hidden="true" href="#cb4-17" tabindex="-1"></a></span>
<span id="cb4-18"><a aria-hidden="true" href="#cb4-18" tabindex="-1"></a>    regions_drilldown <span class="ot">&lt;-</span> eng <span class="sc">|&gt;</span></span>
<span id="cb4-19"><a aria-hidden="true" href="#cb4-19" tabindex="-1"></a>        <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb4-20"><a aria-hidden="true" href="#cb4-20" tabindex="-1"></a>        <span class="fu">group_nest</span>(regioncode, regionname) <span class="sc">|&gt;</span></span>
<span id="cb4-21"><a aria-hidden="true" href="#cb4-21" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb4-22"><a aria-hidden="true" href="#cb4-22" tabindex="-1"></a>            <span class="at">id =</span> regionname,</span>
<span id="cb4-23"><a aria-hidden="true" href="#cb4-23" tabindex="-1"></a>            <span class="at">type =</span> <span class="st">"column"</span>,</span>
<span id="cb4-24"><a aria-hidden="true" href="#cb4-24" tabindex="-1"></a>            <span class="co"># in the drilldown we'll give the mapping via creating the columns</span></span>
<span id="cb4-25"><a aria-hidden="true" href="#cb4-25" tabindex="-1"></a>            <span class="at">data =</span> <span class="fu">lapply</span>(data, mutate, <span class="at">name =</span> lad19nm, pop60, <span class="at">y =</span> imdscore, imdrank, <span class="at">imdscorepretty =</span> <span class="fu">round</span>(imdscore, <span class="dv">2</span>)),</span>
<span id="cb4-26"><a aria-hidden="true" href="#cb4-26" tabindex="-1"></a>            <span class="at">data =</span> <span class="fu">lapply</span>(data, \(x) <span class="fu">list_parse</span>(</span>
<span id="cb4-27"><a aria-hidden="true" href="#cb4-27" tabindex="-1"></a>                <span class="fu">arrange</span>(x, <span class="fu">desc</span>(imdrank)) <span class="sc">|&gt;</span></span>
<span id="cb4-28"><a aria-hidden="true" href="#cb4-28" tabindex="-1"></a>                    <span class="fu">mutate</span>(<span class="at">localrank =</span> <span class="fu">rev</span>(<span class="fu">row_number</span>()))</span>
<span id="cb4-29"><a aria-hidden="true" href="#cb4-29" tabindex="-1"></a>            ))</span>
<span id="cb4-30"><a aria-hidden="true" href="#cb4-30" tabindex="-1"></a>        )</span>
<span id="cb4-31"><a aria-hidden="true" href="#cb4-31" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb4-32"><a aria-hidden="true" href="#cb4-32" tabindex="-1"></a>        <span class="at">regions_column =</span> regions_column,</span>
<span id="cb4-33"><a aria-hidden="true" href="#cb4-33" tabindex="-1"></a>        <span class="at">regions_drilldown =</span> regions_drilldown</span>
<span id="cb4-34"><a aria-hidden="true" href="#cb4-34" tabindex="-1"></a>    )</span>
<span id="cb4-35"><a aria-hidden="true" href="#cb4-35" tabindex="-1"></a>}</span>
<span id="cb4-36"><a aria-hidden="true" href="#cb4-36" tabindex="-1"></a></span>
<span id="cb4-37"><a aria-hidden="true" href="#cb4-37" tabindex="-1"></a>draw_drilldown_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(eng) {</span>
<span id="cb4-38"><a aria-hidden="true" href="#cb4-38" tabindex="-1"></a>    drilldown_data <span class="ot">&lt;-</span> <span class="fu">create_drilldown_data</span>(eng)</span>
<span id="cb4-39"><a aria-hidden="true" href="#cb4-39" tabindex="-1"></a></span>
<span id="cb4-40"><a aria-hidden="true" href="#cb4-40" tabindex="-1"></a>    tooltip_x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"IMD score"</span>, <span class="st">"IMD rank (national)"</span>, <span class="st">"IMD rank (local)"</span>)</span>
<span id="cb4-41"><a aria-hidden="true" href="#cb4-41" tabindex="-1"></a>    tooltip_y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"{point.imdscorepretty}"</span>, <span class="st">"{point.imdrank}"</span>, <span class="st">"{point.localrank}"</span>)</span>
<span id="cb4-42"><a aria-hidden="true" href="#cb4-42" tabindex="-1"></a></span>
<span id="cb4-43"><a aria-hidden="true" href="#cb4-43" tabindex="-1"></a>    <span class="fu">hchart</span>(</span>
<span id="cb4-44"><a aria-hidden="true" href="#cb4-44" tabindex="-1"></a>        drilldown_data<span class="sc">$</span>regions_column,</span>
<span id="cb4-45"><a aria-hidden="true" href="#cb4-45" tabindex="-1"></a>        <span class="st">"column"</span>,</span>
<span id="cb4-46"><a aria-hidden="true" href="#cb4-46" tabindex="-1"></a>        <span class="fu">hcaes</span>(<span class="at">x =</span> regionname, <span class="at">y =</span> imdscore, <span class="at">name =</span> regionname, <span class="at">drilldown =</span> regionname),</span>
<span id="cb4-47"><a aria-hidden="true" href="#cb4-47" tabindex="-1"></a>        <span class="at">name =</span> <span class="st">"Region"</span>,</span>
<span id="cb4-48"><a aria-hidden="true" href="#cb4-48" tabindex="-1"></a>        <span class="at">colorByPoint =</span> <span class="cn">TRUE</span></span>
<span id="cb4-49"><a aria-hidden="true" href="#cb4-49" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb4-50"><a aria-hidden="true" href="#cb4-50" tabindex="-1"></a>        <span class="fu">hc_drilldown</span>(</span>
<span id="cb4-51"><a aria-hidden="true" href="#cb4-51" tabindex="-1"></a>            <span class="at">allowPointDrilldown =</span> <span class="cn">TRUE</span>,</span>
<span id="cb4-52"><a aria-hidden="true" href="#cb4-52" tabindex="-1"></a>            <span class="at">series =</span> <span class="fu">list_parse</span>(drilldown_data<span class="sc">$</span>regions_drilldown)</span>
<span id="cb4-53"><a aria-hidden="true" href="#cb4-53" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb4-54"><a aria-hidden="true" href="#cb4-54" tabindex="-1"></a>        <span class="fu">hc_tooltip</span>(</span>
<span id="cb4-55"><a aria-hidden="true" href="#cb4-55" tabindex="-1"></a>            <span class="at">pointFormat =</span> <span class="fu">tooltip_table</span>(tooltip_x, tooltip_y),</span>
<span id="cb4-56"><a aria-hidden="true" href="#cb4-56" tabindex="-1"></a>            <span class="at">useHTML =</span> <span class="cn">TRUE</span>,</span>
<span id="cb4-57"><a aria-hidden="true" href="#cb4-57" tabindex="-1"></a>            <span class="at">valueDecimals =</span> <span class="dv">0</span></span>
<span id="cb4-58"><a aria-hidden="true" href="#cb4-58" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb4-59"><a aria-hidden="true" href="#cb4-59" tabindex="-1"></a>        <span class="fu">hc_yAxis</span>(</span>
<span id="cb4-60"><a aria-hidden="true" href="#cb4-60" tabindex="-1"></a>            <span class="at">title =</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="st">"Proportion of economically deprived older individuals"</span>),</span>
<span id="cb4-61"><a aria-hidden="true" href="#cb4-61" tabindex="-1"></a>            <span class="at">minorTickInterval =</span> <span class="st">"auto"</span></span>
<span id="cb4-62"><a aria-hidden="true" href="#cb4-62" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb4-63"><a aria-hidden="true" href="#cb4-63" tabindex="-1"></a>        <span class="fu">hc_xAxis</span>(</span>
<span id="cb4-64"><a aria-hidden="true" href="#cb4-64" tabindex="-1"></a>            <span class="at">title =</span> <span class="st">""</span></span>
<span id="cb4-65"><a aria-hidden="true" href="#cb4-65" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb4-66"><a aria-hidden="true" href="#cb4-66" tabindex="-1"></a>        <span class="fu">hc_title</span>(</span>
<span id="cb4-67"><a aria-hidden="true" href="#cb4-67" tabindex="-1"></a>            <span class="at">text =</span> <span class="st">"Proportion of economically deprived older individuals"</span></span>
<span id="cb4-68"><a aria-hidden="true" href="#cb4-68" tabindex="-1"></a>        )</span>
<span id="cb4-69"><a aria-hidden="true" href="#cb4-69" tabindex="-1"></a>}</span>
<span id="cb4-70"><a aria-hidden="true" href="#cb4-70" tabindex="-1"></a></span>
<span id="cb4-71"><a aria-hidden="true" href="#cb4-71" tabindex="-1"></a><span class="fu">draw_drilldown_plot</span>(eng)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="highchart html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-381d05ac1add2aa4e872" style="width:100%;height:464px;"></div>
<script data-for="htmlwidget-381d05ac1add2aa4e872" type="application/json"></script>
</div>
</div>
<div class="no-row-height column-margin column-container"><div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
This is a drill down plot
</div>
</div>
<div class="callout-body-container callout-body">
<p>Click a region’s bar to see the distribution within that region</p>
</div>
</div></div><p>The highlighted authority in the north, <span class="eden">Eden</span>, has a population of of 18,000. In fact, much of the <span style="color: #e4d353; font-weight: bold;">North West</span> region is covered by national parks, and there are several large local authorities which have very small populations. Similarly, click the <span style="color: #2b908f; font-weight: bold;">North East</span> region column on the bar plot, and you’ll see there’s only one area that is not red, Northumberland. This area comprises 15% of the older population of the region, but almost 60% of the land. <span class="barnet">Barnet</span> highlights the same issue across <span style="color: #f45b5b; font-weight: bold;">London</span>: older people face significant deprivation here. However, only 1.2% of England’s area is covered by London, an area so small that the colour of the polygons is barely visible. Interactive packages like <code>leaflet</code> mitigate this through zoom. However, cartographic approaches can represent data by the variables of interest, such as population, rather than geography.</p>
<!-- London pop numbers if I want them 11% of its older population (and 16% of the total population) -->
</section>
<section class="level1 page-columns page-full" id="from-maps-to-cartograms">
<h1>From maps to cartograms</h1>
<section class="level2 page-columns page-full" id="hex-cartograms">
<h2 class="anchored" data-anchor-id="hex-cartograms">Hex cartograms</h2>
<p>A hex cartogram uses tesellating hexagons to represent geographic areas.<span class="citation" data-cites="carr1992hexagon"><sup><a href="#ref-carr1992hexagon" role="doc-biblioref">3</a></sup></span> We can <a href="https://rpubs.com/Hailstone/326118">generate hexagons from geographic polygons in R</a>, but in the case of UK local authorities <a href="https://open-innovations.org/">Open Innovations</a> has done the work for us. Their <a href="https://github.com/odileeds/hexmaps/tree/gh-pages/maps">open source UK hex map</a> is published in <a href="https://open-innovations.org/projects/hexmaps/hexjson.html">hexjson format</a>. We can use the very handy R package <a href="https://github.com/psychemedia/htmlwidget-hexjson"><code>hexjsonwidget</code></a> to create the map in the margin with very little code.</p>
<div class="no-row-height column-margin column-container"><div class="">
<div class="quarto-figure quarto-figure-center anchored" id="fig-hexmapsimple">
<figure class="figure">
<p><img class="img-fluid figure-img" src="./img/hexmap_simple.png"/></p>
<figcaption class="figure-caption">Figure 1: A hex cartogram</figcaption>
</figure>
</div>
</div></div><div>
<details>
<summary>Show code to shape the data for a hex cartogram with <code>hexjsonwidget</code></summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a aria-hidden="true" href="#cb5-1" tabindex="-1"></a><span class="co"># Get a json of UK hexes</span></span>
<span id="cb5-2"><a aria-hidden="true" href="#cb5-2" tabindex="-1"></a>create_eng_lads <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">hexjson_url =</span> <span class="st">"https://raw.githubusercontent.com/odileeds/hexmaps/gh-pages/maps/uk-local-authority-districts-2019.hexjson"</span>,</span>
<span id="cb5-3"><a aria-hidden="true" href="#cb5-3" tabindex="-1"></a>                            <span class="at">hex_cols =</span> <span class="fu">c</span>(<span class="st">"lad19cd"</span>, <span class="st">"color"</span>, <span class="st">"rank"</span> <span class="ot">=</span> <span class="st">"imdrank"</span>, <span class="st">"label"</span>, <span class="st">"highlight"</span>, <span class="st">"highlight_color"</span>)) {</span>
<span id="cb5-4"><a aria-hidden="true" href="#cb5-4" tabindex="-1"></a>    lads <span class="ot">&lt;-</span> jsonlite<span class="sc">::</span><span class="fu">fromJSON</span>(<span class="fu">download_data</span>(hexjson_url))</span>
<span id="cb5-5"><a aria-hidden="true" href="#cb5-5" tabindex="-1"></a></span>
<span id="cb5-6"><a aria-hidden="true" href="#cb5-6" tabindex="-1"></a>    <span class="co"># Filter hex json data to IDs which start with "E" (England LAs)</span></span>
<span id="cb5-7"><a aria-hidden="true" href="#cb5-7" tabindex="-1"></a>    eng_hexes_df <span class="ot">&lt;-</span> <span class="fu">Filter</span>(\(x) <span class="fu">startsWith</span>(x<span class="sc">$</span>id, <span class="st">"E"</span>), lads[[<span class="st">"hexes"</span>]]) <span class="sc">|&gt;</span></span>
<span id="cb5-8"><a aria-hidden="true" href="#cb5-8" tabindex="-1"></a>        <span class="fu">lapply</span>(data.frame) <span class="sc">|&gt;</span></span>
<span id="cb5-9"><a aria-hidden="true" href="#cb5-9" tabindex="-1"></a>        <span class="fu">bind_rows</span>() <span class="sc">|&gt;</span></span>
<span id="cb5-10"><a aria-hidden="true" href="#cb5-10" tabindex="-1"></a>        <span class="co"># Join with our `eng` dataset</span></span>
<span id="cb5-11"><a aria-hidden="true" href="#cb5-11" tabindex="-1"></a>        <span class="fu">inner_join</span>(</span>
<span id="cb5-12"><a aria-hidden="true" href="#cb5-12" tabindex="-1"></a>            <span class="fu">st_drop_geometry</span>(<span class="fu">select</span>(eng, <span class="fu">all_of</span>(hex_cols))),</span>
<span id="cb5-13"><a aria-hidden="true" href="#cb5-13" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"id"</span> <span class="ot">=</span> <span class="st">"lad19cd"</span>)</span>
<span id="cb5-14"><a aria-hidden="true" href="#cb5-14" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb5-15"><a aria-hidden="true" href="#cb5-15" tabindex="-1"></a>        <span class="co"># Create a lad_id for each html node with no spaces or special characters</span></span>
<span id="cb5-16"><a aria-hidden="true" href="#cb5-16" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">lad_id =</span> <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">W+"</span>, <span class="st">"_"</span>, n))</span>
<span id="cb5-17"><a aria-hidden="true" href="#cb5-17" tabindex="-1"></a></span>
<span id="cb5-18"><a aria-hidden="true" href="#cb5-18" tabindex="-1"></a>    <span class="co"># Make the data frame into a list</span></span>
<span id="cb5-19"><a aria-hidden="true" href="#cb5-19" tabindex="-1"></a>    eng_hexes <span class="ot">&lt;-</span> highcharter<span class="sc">::</span><span class="fu">list_parse</span>(eng_hexes_df) <span class="sc">|&gt;</span></span>
<span id="cb5-20"><a aria-hidden="true" href="#cb5-20" tabindex="-1"></a>        <span class="fu">setNames</span>(eng_hexes_df<span class="sc">$</span>id)</span>
<span id="cb5-21"><a aria-hidden="true" href="#cb5-21" tabindex="-1"></a></span>
<span id="cb5-22"><a aria-hidden="true" href="#cb5-22" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">layout =</span> lads[[<span class="st">"layout"</span>]], <span class="at">hexes =</span> eng_hexes)</span>
<span id="cb5-23"><a aria-hidden="true" href="#cb5-23" tabindex="-1"></a>}</span>
<span id="cb5-24"><a aria-hidden="true" href="#cb5-24" tabindex="-1"></a></span>
<span id="cb5-25"><a aria-hidden="true" href="#cb5-25" tabindex="-1"></a>eng_lads <span class="ot">&lt;-</span> <span class="fu">create_eng_lads</span>()</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel">
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a aria-hidden="true" href="#cb6-1" tabindex="-1"></a><span class="co"># Code to create the map in the margin</span></span>
<span id="cb6-2"><a aria-hidden="true" href="#cb6-2" tabindex="-1"></a>hexjsonwidget<span class="sc">::</span><span class="fu">hexjsonwidget</span>(</span>
<span id="cb6-3"><a aria-hidden="true" href="#cb6-3" tabindex="-1"></a>    eng_lads, <span class="at">colour =</span> <span class="st">"color"</span>, <span class="at">label =</span> <span class="cn">NA</span>, <span class="at">elementId =</span> <span class="st">"foldable_hex"</span></span>
<span id="cb6-4"><a aria-hidden="true" href="#cb6-4" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</div>
<p>The hex cartogram needs a legend and a way to identify each area, such as a tooltip. The <code>hexjsonwidget</code> R package is a wrapper for the JavaScript library <a href="https://github.com/olihawkins/d3-hexjson"><code>d3-hexjson</code></a>, which in turn is built on <a href="https://d3js.org/"><code>d3.js</code></a>, a free, open-source JavaScript library for visualizing data. We can write a little more JavaScript to add what we need. First, we can create a file, <code>tooltip.js</code>, which defines a function to draw a tooltip when we hover over a hexagon.</p>
<div class="cell">
<details>
<summary>Show the tooltip javascript</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb7-1"><a aria-hidden="true" href="#cb7-1" tabindex="-1"></a><span class="kw">function</span> <span class="fu">highlightPolygons</span>(polygons) {</span>
<span id="cb7-2"><a aria-hidden="true" href="#cb7-2" tabindex="-1"></a>  <span class="co">// Highlight the required polygons</span></span>
<span id="cb7-3"><a aria-hidden="true" href="#cb7-3" tabindex="-1"></a>  polygons<span class="op">.</span><span class="fu">each</span>(<span class="kw">function</span> (d) {</span>
<span id="cb7-4"><a aria-hidden="true" href="#cb7-4" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> d<span class="op">.</span><span class="at">highlight_color</span>)<span class="op">;</span></span>
<span id="cb7-5"><a aria-hidden="true" href="#cb7-5" tabindex="-1"></a>    <span class="cf">if</span> (d<span class="op">.</span><span class="at">highlight</span>) {</span>
<span id="cb7-6"><a aria-hidden="true" href="#cb7-6" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb7-7"><a aria-hidden="true" href="#cb7-7" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span><span class="op">.</span><span class="at">parentElement</span>)<span class="op">.</span><span class="fu">raise</span>()<span class="op">;</span></span>
<span id="cb7-8"><a aria-hidden="true" href="#cb7-8" tabindex="-1"></a>    }</span>
<span id="cb7-9"><a aria-hidden="true" href="#cb7-9" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb7-10"><a aria-hidden="true" href="#cb7-10" tabindex="-1"></a>}</span>
<span id="cb7-11"><a aria-hidden="true" href="#cb7-11" tabindex="-1"></a></span>
<span id="cb7-12"><a aria-hidden="true" href="#cb7-12" tabindex="-1"></a><span class="kw">function</span> <span class="fu">createToolTip</span>() {</span>
<span id="cb7-13"><a aria-hidden="true" href="#cb7-13" tabindex="-1"></a>  <span class="co">// Find the map element (eng_hex) and  polygons</span></span>
<span id="cb7-14"><a aria-hidden="true" href="#cb7-14" tabindex="-1"></a>  <span class="kw">let</span> svg <span class="op">=</span> d3<span class="op">.</span><span class="fu">select</span>(<span class="st">"#eng_hex"</span>)<span class="op">;</span></span>
<span id="cb7-15"><a aria-hidden="true" href="#cb7-15" tabindex="-1"></a>  <span class="kw">let</span> polygons <span class="op">=</span> svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"polygon"</span>)<span class="op">;</span></span>
<span id="cb7-16"><a aria-hidden="true" href="#cb7-16" tabindex="-1"></a>  <span class="co">// Create a container for the hover text</span></span>
<span id="cb7-17"><a aria-hidden="true" href="#cb7-17" tabindex="-1"></a>  svg</span>
<span id="cb7-18"><a aria-hidden="true" href="#cb7-18" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb7-19"><a aria-hidden="true" href="#cb7-19" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"position"</span><span class="op">,</span> <span class="st">"absolute"</span>)</span>
<span id="cb7-20"><a aria-hidden="true" href="#cb7-20" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"background-color"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb7-21"><a aria-hidden="true" href="#cb7-21" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"border"</span><span class="op">,</span> <span class="st">"solid"</span>)</span>
<span id="cb7-22"><a aria-hidden="true" href="#cb7-22" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"border-width"</span><span class="op">,</span> <span class="st">"1px"</span>)</span>
<span id="cb7-23"><a aria-hidden="true" href="#cb7-23" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"border-radius"</span><span class="op">,</span> <span class="st">"10px"</span>)</span>
<span id="cb7-24"><a aria-hidden="true" href="#cb7-24" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"padding"</span><span class="op">,</span> <span class="st">"10px"</span>)</span>
<span id="cb7-25"><a aria-hidden="true" href="#cb7-25" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"Arial, Helvetica, sans-serif"</span>)</span>
<span id="cb7-26"><a aria-hidden="true" href="#cb7-26" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"color"</span><span class="op">,</span> <span class="st">"white"</span>)</span>
<span id="cb7-27"><a aria-hidden="true" href="#cb7-27" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"hidden"</span>)</span>
<span id="cb7-28"><a aria-hidden="true" href="#cb7-28" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"hoverText"</span>)</span>
<span id="cb7-29"><a aria-hidden="true" href="#cb7-29" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">""</span>)<span class="op">;</span></span>
<span id="cb7-30"><a aria-hidden="true" href="#cb7-30" tabindex="-1"></a></span>
<span id="cb7-31"><a aria-hidden="true" href="#cb7-31" tabindex="-1"></a>  <span class="fu">highlightPolygons</span>(polygons)<span class="op">;</span></span>
<span id="cb7-32"><a aria-hidden="true" href="#cb7-32" tabindex="-1"></a>  <span class="co">// Show tooltip when mouse is over polygon</span></span>
<span id="cb7-33"><a aria-hidden="true" href="#cb7-33" tabindex="-1"></a>  polygons<span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseover"</span><span class="op">,</span> <span class="kw">function</span> (d) {</span>
<span id="cb7-34"><a aria-hidden="true" href="#cb7-34" tabindex="-1"></a>    <span class="co">// Get mouse position for tooltip</span></span>
<span id="cb7-35"><a aria-hidden="true" href="#cb7-35" tabindex="-1"></a>    <span class="kw">let</span> mouseOffset <span class="op">=</span> <span class="dv">15</span><span class="op">;</span> <span class="co">// pixels</span></span>
<span id="cb7-36"><a aria-hidden="true" href="#cb7-36" tabindex="-1"></a>    <span class="kw">let</span> mousePos <span class="op">=</span> d3<span class="op">.</span><span class="fu">mouse</span>(<span class="bu">document</span><span class="op">.</span><span class="at">body</span>)<span class="op">;</span></span>
<span id="cb7-37"><a aria-hidden="true" href="#cb7-37" tabindex="-1"></a>    <span class="co">// Put the correct text in the tooltip</span></span>
<span id="cb7-38"><a aria-hidden="true" href="#cb7-38" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">select</span>(<span class="st">"#hoverText"</span>)</span>
<span id="cb7-39"><a aria-hidden="true" href="#cb7-39" tabindex="-1"></a>      <span class="op">.</span><span class="fu">html</span>(d<span class="op">.</span><span class="at">label</span>)</span>
<span id="cb7-40"><a aria-hidden="true" href="#cb7-40" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"left"</span><span class="op">,</span> mousePos[<span class="dv">0</span>] <span class="op">+</span> mouseOffset <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb7-41"><a aria-hidden="true" href="#cb7-41" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"top"</span><span class="op">,</span> mousePos[<span class="dv">1</span>] <span class="op">+</span> mouseOffset <span class="op">+</span> <span class="st">"px"</span>)<span class="op">;</span></span>
<span id="cb7-42"><a aria-hidden="true" href="#cb7-42" tabindex="-1"></a>    <span class="co">// Highlight this polygon and make it slightly larger</span></span>
<span id="cb7-43"><a aria-hidden="true" href="#cb7-43" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span>)</span>
<span id="cb7-44"><a aria-hidden="true" href="#cb7-44" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="kw">function</span> (d) {</span>
<span id="cb7-45"><a aria-hidden="true" href="#cb7-45" tabindex="-1"></a>        <span class="cf">return</span> d<span class="op">.</span><span class="at">highlight</span> <span class="op">?</span> d<span class="op">.</span><span class="at">highlight_color</span> <span class="op">:</span> <span class="st">"white"</span><span class="op">;</span></span>
<span id="cb7-46"><a aria-hidden="true" href="#cb7-46" tabindex="-1"></a>      })</span>
<span id="cb7-47"><a aria-hidden="true" href="#cb7-47" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="st">"scale(1.2)"</span>)<span class="op">;</span></span>
<span id="cb7-48"><a aria-hidden="true" href="#cb7-48" tabindex="-1"></a>    <span class="co">// Bring to front so highlighted border is visible</span></span>
<span id="cb7-49"><a aria-hidden="true" href="#cb7-49" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span><span class="op">.</span><span class="at">parentElement</span>)<span class="op">.</span><span class="fu">raise</span>()<span class="op">;</span></span>
<span id="cb7-50"><a aria-hidden="true" href="#cb7-50" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb7-51"><a aria-hidden="true" href="#cb7-51" tabindex="-1"></a></span>
<span id="cb7-52"><a aria-hidden="true" href="#cb7-52" tabindex="-1"></a>  <span class="co">// Set each polygon back to normal on mouse out</span></span>
<span id="cb7-53"><a aria-hidden="true" href="#cb7-53" tabindex="-1"></a>  polygons<span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseout"</span><span class="op">,</span> <span class="kw">function</span> (d) {</span>
<span id="cb7-54"><a aria-hidden="true" href="#cb7-54" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span>)</span>
<span id="cb7-55"><a aria-hidden="true" href="#cb7-55" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="kw">function</span> (d) {</span>
<span id="cb7-56"><a aria-hidden="true" href="#cb7-56" tabindex="-1"></a>        <span class="cf">return</span> d<span class="op">.</span><span class="at">highlight</span> <span class="op">?</span> d<span class="op">.</span><span class="at">highlight_color</span> <span class="op">:</span> <span class="st">"black"</span><span class="op">;</span></span>
<span id="cb7-57"><a aria-hidden="true" href="#cb7-57" tabindex="-1"></a>      })</span>
<span id="cb7-58"><a aria-hidden="true" href="#cb7-58" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="st">"scale(1)"</span>)<span class="op">;</span></span>
<span id="cb7-59"><a aria-hidden="true" href="#cb7-59" tabindex="-1"></a>    <span class="fu">highlightPolygons</span>(polygons)<span class="op">;</span> <span class="co">// bring highlighted to top</span></span>
<span id="cb7-60"><a aria-hidden="true" href="#cb7-60" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb7-61"><a aria-hidden="true" href="#cb7-61" tabindex="-1"></a>  <span class="co">// Hide tooltip when mouse is not over the map</span></span>
<span id="cb7-62"><a aria-hidden="true" href="#cb7-62" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseout"</span><span class="op">,</span> <span class="kw">function</span> () {</span>
<span id="cb7-63"><a aria-hidden="true" href="#cb7-63" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">select</span>(<span class="st">"#hoverText"</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"hidden"</span>)<span class="op">;</span></span>
<span id="cb7-64"><a aria-hidden="true" href="#cb7-64" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb7-65"><a aria-hidden="true" href="#cb7-65" tabindex="-1"></a>  <span class="co">// Show tooltip when mouse is over the map</span></span>
<span id="cb7-66"><a aria-hidden="true" href="#cb7-66" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseover"</span><span class="op">,</span> <span class="kw">function</span> () {</span>
<span id="cb7-67"><a aria-hidden="true" href="#cb7-67" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">select</span>(<span class="st">"#hoverText"</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"visible"</span>)<span class="op">;</span></span>
<span id="cb7-68"><a aria-hidden="true" href="#cb7-68" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb7-69"><a aria-hidden="true" href="#cb7-69" tabindex="-1"></a>}</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</details>

</div>
<p>As we want to use the same legend colors and values that we have already defined, we can write the function as an R character vector and <code>paste()</code> in the the <code>legend_labels</code> and <code>legend_colors</code> we created in R. We can then use the R <code>htmlwidgets::onStaticRenderComplete()</code> function to tell the browser to read in <code>tooltip.js</code>, and add the tooltip and legend once the hexagons are rendered.</p>
<div class="cell">
<details>
<summary>Show the R code to call the tooltip javascript and add a legend</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a aria-hidden="true" href="#cb8-1" tabindex="-1"></a>legend_js <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb8-2"><a aria-hidden="true" href="#cb8-2" tabindex="-1"></a>    <span class="st">'function createLegend(main_svg = "#eng_hex") {</span></span>
<span id="cb8-3"><a aria-hidden="true" href="#cb8-3" tabindex="-1"></a><span class="st">  let vals = ["'</span>, <span class="fu">paste</span>(legend<span class="sc">$</span>legend_labels, <span class="at">collapse =</span> <span class="st">"</span><span class="sc">\"</span><span class="st">,</span><span class="sc">\"</span><span class="st">"</span>), <span class="st">'"];</span></span>
<span id="cb8-4"><a aria-hidden="true" href="#cb8-4" tabindex="-1"></a><span class="st">  let colors = ["'</span>, <span class="fu">paste</span>(legend<span class="sc">$</span>legend_colors, <span class="at">collapse =</span> <span class="st">"</span><span class="sc">\"</span><span class="st">,</span><span class="sc">\"</span><span class="st">"</span>), <span class="st">'"];</span></span>
<span id="cb8-5"><a aria-hidden="true" href="#cb8-5" tabindex="-1"></a><span class="st">  let legend_vals = vals.map((val, i) =&gt; {</span></span>
<span id="cb8-6"><a aria-hidden="true" href="#cb8-6" tabindex="-1"></a><span class="st">    return {</span></span>
<span id="cb8-7"><a aria-hidden="true" href="#cb8-7" tabindex="-1"></a><span class="st">      val: val,</span></span>
<span id="cb8-8"><a aria-hidden="true" href="#cb8-8" tabindex="-1"></a><span class="st">      color: colors[i],</span></span>
<span id="cb8-9"><a aria-hidden="true" href="#cb8-9" tabindex="-1"></a><span class="st">    };</span></span>
<span id="cb8-10"><a aria-hidden="true" href="#cb8-10" tabindex="-1"></a><span class="st">  });</span></span>
<span id="cb8-11"><a aria-hidden="true" href="#cb8-11" tabindex="-1"></a><span class="st">  let svg = d3.select(main_svg);</span></span>
<span id="cb8-12"><a aria-hidden="true" href="#cb8-12" tabindex="-1"></a><span class="st">  svg</span></span>
<span id="cb8-13"><a aria-hidden="true" href="#cb8-13" tabindex="-1"></a><span class="st">    .append("div")</span></span>
<span id="cb8-14"><a aria-hidden="true" href="#cb8-14" tabindex="-1"></a><span class="st">    .style("position", "absolute")</span></span>
<span id="cb8-15"><a aria-hidden="true" href="#cb8-15" tabindex="-1"></a><span class="st">    .style("background-color", "white")</span></span>
<span id="cb8-16"><a aria-hidden="true" href="#cb8-16" tabindex="-1"></a><span class="st">    .style("border", "solid")</span></span>
<span id="cb8-17"><a aria-hidden="true" href="#cb8-17" tabindex="-1"></a><span class="st">    .style("border-width", "0px")</span></span>
<span id="cb8-18"><a aria-hidden="true" href="#cb8-18" tabindex="-1"></a><span class="st">    .style("border-radius", "10px")</span></span>
<span id="cb8-19"><a aria-hidden="true" href="#cb8-19" tabindex="-1"></a><span class="st">    .style("padding", "10px")</span></span>
<span id="cb8-20"><a aria-hidden="true" href="#cb8-20" tabindex="-1"></a><span class="st">    .style("font-family", "Arial, Helvetica, sans-serif")</span></span>
<span id="cb8-21"><a aria-hidden="true" href="#cb8-21" tabindex="-1"></a><span class="st">    .style("color", "black")</span></span>
<span id="cb8-22"><a aria-hidden="true" href="#cb8-22" tabindex="-1"></a><span class="st">    .style("width", "110px")</span></span>
<span id="cb8-23"><a aria-hidden="true" href="#cb8-23" tabindex="-1"></a><span class="st">    .style("left", svg.node().getBoundingClientRect().left)</span></span>
<span id="cb8-24"><a aria-hidden="true" href="#cb8-24" tabindex="-1"></a><span class="st">    .style("top", svg.node().getBoundingClientRect().top)</span></span>
<span id="cb8-25"><a aria-hidden="true" href="#cb8-25" tabindex="-1"></a><span class="st">    .attr("id", "legend")</span></span>
<span id="cb8-26"><a aria-hidden="true" href="#cb8-26" tabindex="-1"></a><span class="st">    .append("svg")</span></span>
<span id="cb8-27"><a aria-hidden="true" href="#cb8-27" tabindex="-1"></a><span class="st">    .attr("id", "legend_svg")</span></span>
<span id="cb8-28"><a aria-hidden="true" href="#cb8-28" tabindex="-1"></a><span class="st">    .style("width", "110px")</span></span>
<span id="cb8-29"><a aria-hidden="true" href="#cb8-29" tabindex="-1"></a><span class="st">    .style("height", "200px");</span></span>
<span id="cb8-30"><a aria-hidden="true" href="#cb8-30" tabindex="-1"></a><span class="st">  svg</span></span>
<span id="cb8-31"><a aria-hidden="true" href="#cb8-31" tabindex="-1"></a><span class="st">    .node()</span></span>
<span id="cb8-32"><a aria-hidden="true" href="#cb8-32" tabindex="-1"></a><span class="st">    .insertBefore(d3.select("#legend").node(), svg.node().childNodes[0]);</span></span>
<span id="cb8-33"><a aria-hidden="true" href="#cb8-33" tabindex="-1"></a></span>
<span id="cb8-34"><a aria-hidden="true" href="#cb8-34" tabindex="-1"></a><span class="st">  let legend = d3.select("#legend_svg");</span></span>
<span id="cb8-35"><a aria-hidden="true" href="#cb8-35" tabindex="-1"></a></span>
<span id="cb8-36"><a aria-hidden="true" href="#cb8-36" tabindex="-1"></a><span class="st">  let size = 20;</span></span>
<span id="cb8-37"><a aria-hidden="true" href="#cb8-37" tabindex="-1"></a><span class="st">  legend</span></span>
<span id="cb8-38"><a aria-hidden="true" href="#cb8-38" tabindex="-1"></a><span class="st">    .selectAll("symbols")</span></span>
<span id="cb8-39"><a aria-hidden="true" href="#cb8-39" tabindex="-1"></a><span class="st">    .data(legend_vals)</span></span>
<span id="cb8-40"><a aria-hidden="true" href="#cb8-40" tabindex="-1"></a><span class="st">    .enter()</span></span>
<span id="cb8-41"><a aria-hidden="true" href="#cb8-41" tabindex="-1"></a><span class="st">    .append("rect")</span></span>
<span id="cb8-42"><a aria-hidden="true" href="#cb8-42" tabindex="-1"></a><span class="st">    .style("stroke", "black")</span></span>
<span id="cb8-43"><a aria-hidden="true" href="#cb8-43" tabindex="-1"></a><span class="st">    .attr("x", 0)</span></span>
<span id="cb8-44"><a aria-hidden="true" href="#cb8-44" tabindex="-1"></a><span class="st">    .attr("y", function (d, i) {</span></span>
<span id="cb8-45"><a aria-hidden="true" href="#cb8-45" tabindex="-1"></a><span class="st">      return i * size * 1.25;</span></span>
<span id="cb8-46"><a aria-hidden="true" href="#cb8-46" tabindex="-1"></a><span class="st">    })</span></span>
<span id="cb8-47"><a aria-hidden="true" href="#cb8-47" tabindex="-1"></a><span class="st">    .attr("width", size)</span></span>
<span id="cb8-48"><a aria-hidden="true" href="#cb8-48" tabindex="-1"></a><span class="st">    .attr("height", size)</span></span>
<span id="cb8-49"><a aria-hidden="true" href="#cb8-49" tabindex="-1"></a><span class="st">    .style("fill", function (d) {</span></span>
<span id="cb8-50"><a aria-hidden="true" href="#cb8-50" tabindex="-1"></a><span class="st">      return d.color;</span></span>
<span id="cb8-51"><a aria-hidden="true" href="#cb8-51" tabindex="-1"></a><span class="st">    });</span></span>
<span id="cb8-52"><a aria-hidden="true" href="#cb8-52" tabindex="-1"></a></span>
<span id="cb8-53"><a aria-hidden="true" href="#cb8-53" tabindex="-1"></a><span class="st">  legend</span></span>
<span id="cb8-54"><a aria-hidden="true" href="#cb8-54" tabindex="-1"></a><span class="st">    .selectAll("labels")</span></span>
<span id="cb8-55"><a aria-hidden="true" href="#cb8-55" tabindex="-1"></a><span class="st">    .data(legend_vals)</span></span>
<span id="cb8-56"><a aria-hidden="true" href="#cb8-56" tabindex="-1"></a><span class="st">    .enter()</span></span>
<span id="cb8-57"><a aria-hidden="true" href="#cb8-57" tabindex="-1"></a><span class="st">    .append("text")</span></span>
<span id="cb8-58"><a aria-hidden="true" href="#cb8-58" tabindex="-1"></a><span class="st">    .attr("x", size * 1.2)</span></span>
<span id="cb8-59"><a aria-hidden="true" href="#cb8-59" tabindex="-1"></a><span class="st">    .attr("y", function (d, i) {</span></span>
<span id="cb8-60"><a aria-hidden="true" href="#cb8-60" tabindex="-1"></a><span class="st">      return i * size * 1.25 + size * 0.6;</span></span>
<span id="cb8-61"><a aria-hidden="true" href="#cb8-61" tabindex="-1"></a><span class="st">    })</span></span>
<span id="cb8-62"><a aria-hidden="true" href="#cb8-62" tabindex="-1"></a><span class="st">    .style("fill", function (d) {</span></span>
<span id="cb8-63"><a aria-hidden="true" href="#cb8-63" tabindex="-1"></a><span class="st">      return "black";</span></span>
<span id="cb8-64"><a aria-hidden="true" href="#cb8-64" tabindex="-1"></a><span class="st">    })</span></span>
<span id="cb8-65"><a aria-hidden="true" href="#cb8-65" tabindex="-1"></a><span class="st">    .text(function (d) {</span></span>
<span id="cb8-66"><a aria-hidden="true" href="#cb8-66" tabindex="-1"></a><span class="st">      return d.val;</span></span>
<span id="cb8-67"><a aria-hidden="true" href="#cb8-67" tabindex="-1"></a><span class="st">    })</span></span>
<span id="cb8-68"><a aria-hidden="true" href="#cb8-68" tabindex="-1"></a><span class="st">    .attr("text-anchor", "left")</span></span>
<span id="cb8-69"><a aria-hidden="true" href="#cb8-69" tabindex="-1"></a><span class="st">    .style("alignment-baseline", "middle");</span></span>
<span id="cb8-70"><a aria-hidden="true" href="#cb8-70" tabindex="-1"></a></span>
<span id="cb8-71"><a aria-hidden="true" href="#cb8-71" tabindex="-1"></a><span class="st">    // do not draw over map and stop tooltip hover</span></span>
<span id="cb8-72"><a aria-hidden="true" href="#cb8-72" tabindex="-1"></a><span class="st">    legend.lower();</span></span>
<span id="cb8-73"><a aria-hidden="true" href="#cb8-73" tabindex="-1"></a><span class="st">}'</span></span>
<span id="cb8-74"><a aria-hidden="true" href="#cb8-74" tabindex="-1"></a>)</span>
<span id="cb8-75"><a aria-hidden="true" href="#cb8-75" tabindex="-1"></a></span>
<span id="cb8-76"><a aria-hidden="true" href="#cb8-76" tabindex="-1"></a>tooltip_js <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">"./tooltip.js"</span>)</span>
<span id="cb8-77"><a aria-hidden="true" href="#cb8-77" tabindex="-1"></a></span>
<span id="cb8-78"><a aria-hidden="true" href="#cb8-78" tabindex="-1"></a><span class="co"># Function to call the tooltip and legend functions</span></span>
<span id="cb8-79"><a aria-hidden="true" href="#cb8-79" tabindex="-1"></a>draw_elements_js <span class="ot">&lt;-</span> <span class="st">"function drawElements() {</span></span>
<span id="cb8-80"><a aria-hidden="true" href="#cb8-80" tabindex="-1"></a><span class="st">    createToolTip();</span></span>
<span id="cb8-81"><a aria-hidden="true" href="#cb8-81" tabindex="-1"></a><span class="st">    createLegend();</span></span>
<span id="cb8-82"><a aria-hidden="true" href="#cb8-82" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb8-83"><a aria-hidden="true" href="#cb8-83" tabindex="-1"></a><span class="st">drawElements();</span></span>
<span id="cb8-84"><a aria-hidden="true" href="#cb8-84" tabindex="-1"></a><span class="st">"</span></span>
<span id="cb8-85"><a aria-hidden="true" href="#cb8-85" tabindex="-1"></a></span>
<span id="cb8-86"><a aria-hidden="true" href="#cb8-86" tabindex="-1"></a><span class="co"># This is the actual code that will run on render</span></span>
<span id="cb8-87"><a aria-hidden="true" href="#cb8-87" tabindex="-1"></a>on_render_js <span class="ot">&lt;-</span> <span class="fu">c</span>(legend_js, tooltip_js, draw_elements_js)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a aria-hidden="true" href="#cb9-1" tabindex="-1"></a>hexjsonwidget<span class="sc">::</span><span class="fu">hexjsonwidget</span>(</span>
<span id="cb9-2"><a aria-hidden="true" href="#cb9-2" tabindex="-1"></a>    eng_lads,</span>
<span id="cb9-3"><a aria-hidden="true" href="#cb9-3" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">"color"</span>, <span class="at">label =</span> <span class="cn">NA</span>, <span class="at">width =</span> <span class="st">"400px"</span>, <span class="at">elementId =</span> <span class="st">"eng_hex"</span></span>
<span id="cb9-4"><a aria-hidden="true" href="#cb9-4" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb9-5"><a aria-hidden="true" href="#cb9-5" tabindex="-1"></a>    htmlwidgets<span class="sc">::</span><span class="fu">prependContent</span>(htmlwidgets<span class="sc">::</span><span class="fu">onStaticRenderComplete</span>(on_render_js))</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div class="hexjsonwidget html-widget" id="eng_hex" style="width:400px;height:480px;"></div>
<script data-for="eng_hex" type="application/json"></script>
</div>
</div>
<p>It’s much clearer from this map that the north of England and London are the most deprived regions. However, a hex map sacrifices toplogical accuracy.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Toplogical accuracy">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Toplogical accuracy
</div>
</div>
<div class="callout-body-container callout-body">
<p>Topological accuracy refers to how well the topology of the cartogram matches the topology of the original map. Perfect topology preservation is obtained when two regions are neighbors in the cartogram if and only if they are neighbors in the original map.<span class="citation" data-cites="nusrat2016state"><sup><a href="#ref-nusrat2016state" role="doc-biblioref">1</a></sup></span></p>
</div>
</div>
<p>Most hexagons have six neighbours, whereas in reality local authorities may have more or fewer. A hex cartogram may give a better sense than a geographic map of the comparisons <em>between</em> regions, but <em>within</em> regions it is harder to identify and compare neighbouring areas.</p>
<p>Another issue is that equal-sized hexagons are used to guarantee tessellation. However, <span class="birmingham">Birmingham</span>, for example, has more than 10 times as many older people than <span class="eden">Eden</span>. Is creating hexagons of equal size the most appropriate representation?</p>
</section>
<section class="level2 page-columns page-full" id="contiguous-and-non-contiguous-cartograms">
<h2 class="anchored" data-anchor-id="contiguous-and-non-contiguous-cartograms">Contiguous and non-contiguous cartograms</h2>
<p>Indeed, there is significant variation in population between local authorities, as we see in the plot in the margin.</p>
<div class="cell page-columns page-full">
<details>
<summary>Show population bar plot code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a aria-hidden="true" href="#cb10-1" tabindex="-1"></a><span class="fu">library</span>(highcharter)</span>
<span id="cb10-2"><a aria-hidden="true" href="#cb10-2" tabindex="-1"></a><span class="fu">draw_bar_plot</span>(eng,</span>
<span id="cb10-3"><a aria-hidden="true" href="#cb10-3" tabindex="-1"></a>    pop60,</span>
<span id="cb10-4"><a aria-hidden="true" href="#cb10-4" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">"Local authorities (sorted by population age 60+)"</span>,</span>
<span id="cb10-5"><a aria-hidden="true" href="#cb10-5" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">"Population"</span>,</span>
<span id="cb10-6"><a aria-hidden="true" href="#cb10-6" tabindex="-1"></a>    <span class="at">plot_title =</span> <span class="st">"Distribution of older population by local authority"</span>,</span>
<span id="cb10-7"><a aria-hidden="true" href="#cb10-7" tabindex="-1"></a>    <span class="at">series_name =</span> <span class="st">"Older pop"</span></span>
<span id="cb10-8"><a aria-hidden="true" href="#cb10-8" tabindex="-1"></a>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</details>
<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div class="highchart html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-cd8ebe18a04efbadcb87" style="width:100%;height:464px;"></div>
<script data-for="htmlwidget-cd8ebe18a04efbadcb87" type="application/json"></script>
</div></div></div>
<p>One way to address this is to transform the polygons representing each area. We can construct a contiguous area cartogram by a rubber sheet distortion algorithm<span class="citation" data-cites="dougenik1985algorithm"><sup><a href="#ref-dougenik1985algorithm" role="doc-biblioref">4</a></sup></span> or a non-contiguous cartogram<span class="citation" data-cites="olson1976noncontiguous"><sup><a href="#ref-olson1976noncontiguous" role="doc-biblioref">5</a></sup></span> using the <a href="https://github.com/sjewo/cartogram"><code>cartogram</code></a> R package.</p>
<div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a aria-hidden="true" href="#cb11-1" tabindex="-1"></a><span class="fu">library</span>(cartogram)</span>
<span id="cb11-2"><a aria-hidden="true" href="#cb11-2" tabindex="-1"></a><span class="co"># Calculate contiguous cartogram borders (left)</span></span>
<span id="cb11-3"><a aria-hidden="true" href="#cb11-3" tabindex="-1"></a>eng_cont <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(eng, <span class="st">"EPSG:27700"</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-4"><a aria-hidden="true" href="#cb11-4" tabindex="-1"></a>    <span class="fu">cartogram_cont</span>(<span class="at">weight =</span> <span class="st">"pop60"</span>, <span class="at">itermax =</span> <span class="dv">5</span>)</span>
<span id="cb11-5"><a aria-hidden="true" href="#cb11-5" tabindex="-1"></a></span>
<span id="cb11-6"><a aria-hidden="true" href="#cb11-6" tabindex="-1"></a><span class="co"># Calculate non-contiguous cartogram borders (right)</span></span>
<span id="cb11-7"><a aria-hidden="true" href="#cb11-7" tabindex="-1"></a>eng_ncont <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(eng, <span class="st">"EPSG:27700"</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-8"><a aria-hidden="true" href="#cb11-8" tabindex="-1"></a>    <span class="fu">cartogram_ncont</span>(<span class="at">weight =</span> <span class="st">"pop60"</span>, <span class="at">k =</span> <span class="fl">0.8</span>)</span>
<span id="cb11-9"><a aria-hidden="true" href="#cb11-9" tabindex="-1"></a></span>
<span id="cb11-10"><a aria-hidden="true" href="#cb11-10" tabindex="-1"></a><span class="co"># Draw cartograms</span></span>
<span id="cb11-11"><a aria-hidden="true" href="#cb11-11" tabindex="-1"></a><span class="fu">create_map</span>(eng_cont, <span class="st">"leafletBlackCont"</span>, <span class="at">zoom =</span> <span class="fl">6.1</span>)</span>
<span id="cb11-12"><a aria-hidden="true" href="#cb11-12" tabindex="-1"></a><span class="co"># Add the England boundaries to the non-contiguous cartogram</span></span>
<span id="cb11-13"><a aria-hidden="true" href="#cb11-13" tabindex="-1"></a><span class="fu">create_map</span>(eng_ncont, <span class="st">"leafletBlackNcont"</span>, <span class="at">zoom =</span> <span class="fl">6.1</span>, <span class="at">base_boundaries =</span> eng)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
<div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="leafletBlackCont" style="width:100%;height:464px;"></div>
<script data-for="leafletBlackCont" type="application/json"></script>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="leafletBlackNcont" style="width:100%;height:464px;"></div>
<script data-for="leafletBlackNcont" type="application/json"></script>
</div>
</div>
</div>
</div>
<p>In both maps, the polygons are transformed, but the centroid of each new polygon is fixed to the centroids of the respective local authority. The contiguous area cartogram, on the left, is more aesthetically pleasing. However, because the size of each polygon is distorted proportional to its population, this leads to overlap in areas like London, where many local authorities with large population border one another. <span class="barnet">Barnet</span> overlaps its neighbour, as do most London local authorities. Furthermore, to maintain the contiguous appearance, small areas surrounded by other small areas, like <span class="eden">Eden</span>, can end up stretched larger than their population warrants. In order to achieve a more aesthetically pleasing map, we trade-off some <em>statistical accuracy</em>.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Statistical accuracy">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Statistical accuracy
</div>
</div>
<div class="callout-body-container callout-body">
<p>Statistical accuracy refers to how well the modified areas represent the corresponding statistic shown<span class="citation" data-cites="nusrat2016state"><sup><a href="#ref-nusrat2016state" role="doc-biblioref">1</a></sup></span> (in our case, population).</p>
</div>
</div>
<p>Conversely, the non-contiguous map does not have any overlaps between areas, and each area maintains its centroid and shape, and the size reflects the population size. However, there are large gaps between areas, making it less aesthetically pleasing, and harder to get a sense of the overall pattern, particularly in sparsely populated areas.</p>
</section>
</section>
<section class="level1" id="facet-maps">
<h1>Facet maps</h1>
<p>Another approach to handling regions of different sizes is to use facets. The R <a href="https://cran.r-project.org/web/packages/tmap/vignettes/tmap-getstarted.html"><code>tmap</code></a> library supports this. An advantage of this is that geographically small areas like London are much more prominent. Furthermore, it is much clearer that the North East, for example, has one local authority which comprises over half of its land area.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a aria-hidden="true" href="#cb12-1" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb12-2"><a aria-hidden="true" href="#cb12-2" tabindex="-1"></a></span>
<span id="cb12-3"><a aria-hidden="true" href="#cb12-3" tabindex="-1"></a>create_facet_map <span class="ot">&lt;-</span> <span class="cf">function</span>(eng) {</span>
<span id="cb12-4"><a aria-hidden="true" href="#cb12-4" tabindex="-1"></a>    facet_order <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb12-5"><a aria-hidden="true" href="#cb12-5" tabindex="-1"></a>        <span class="st">"North East"</span>, <span class="st">"Yorkshire and The Humber"</span>, <span class="st">"North West"</span>,</span>
<span id="cb12-6"><a aria-hidden="true" href="#cb12-6" tabindex="-1"></a>        <span class="st">"West Midlands"</span>, <span class="st">"East Midlands"</span>, <span class="st">"East"</span>,</span>
<span id="cb12-7"><a aria-hidden="true" href="#cb12-7" tabindex="-1"></a>        <span class="st">"South West"</span>, <span class="st">"London"</span>, <span class="st">"South East"</span></span>
<span id="cb12-8"><a aria-hidden="true" href="#cb12-8" tabindex="-1"></a>    )</span>
<span id="cb12-9"><a aria-hidden="true" href="#cb12-9" tabindex="-1"></a></span>
<span id="cb12-10"><a aria-hidden="true" href="#cb12-10" tabindex="-1"></a>    <span class="co"># Set facet order and labels</span></span>
<span id="cb12-11"><a aria-hidden="true" href="#cb12-11" tabindex="-1"></a>    eng <span class="ot">&lt;-</span> eng <span class="sc">|&gt;</span></span>
<span id="cb12-12"><a aria-hidden="true" href="#cb12-12" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb12-13"><a aria-hidden="true" href="#cb12-13" tabindex="-1"></a>            <span class="at">tmap_label =</span> <span class="fu">paste0</span>(lad19nm, <span class="st">" (rank: "</span>, imdrank, <span class="st">", score: "</span>, imdscore, <span class="st">")"</span>),</span>
<span id="cb12-14"><a aria-hidden="true" href="#cb12-14" tabindex="-1"></a>            <span class="at">region_fct =</span> <span class="fu">factor</span>(regionname, <span class="at">levels =</span> facet_order)</span>
<span id="cb12-15"><a aria-hidden="true" href="#cb12-15" tabindex="-1"></a>        )</span>
<span id="cb12-16"><a aria-hidden="true" href="#cb12-16" tabindex="-1"></a></span>
<span id="cb12-17"><a aria-hidden="true" href="#cb12-17" tabindex="-1"></a>    <span class="fu">tmap_mode</span>(<span class="st">"view"</span>)</span>
<span id="cb12-18"><a aria-hidden="true" href="#cb12-18" tabindex="-1"></a>    <span class="co"># Hack to circumvent tmap not supporting polygon border</span></span>
<span id="cb12-19"><a aria-hidden="true" href="#cb12-19" tabindex="-1"></a>    <span class="co"># of different colors: cast to lines and draw those</span></span>
<span id="cb12-20"><a aria-hidden="true" href="#cb12-20" tabindex="-1"></a>    eng_lines <span class="ot">&lt;-</span> eng <span class="sc">|&gt;</span></span>
<span id="cb12-21"><a aria-hidden="true" href="#cb12-21" tabindex="-1"></a>        <span class="fu">st_cast</span>(<span class="st">"MULTILINESTRING"</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-22"><a aria-hidden="true" href="#cb12-22" tabindex="-1"></a>        <span class="fu">arrange</span>(highlight)</span>
<span id="cb12-23"><a aria-hidden="true" href="#cb12-23" tabindex="-1"></a></span>
<span id="cb12-24"><a aria-hidden="true" href="#cb12-24" tabindex="-1"></a>    <span class="fu">tm_shape</span>(eng) <span class="sc">+</span></span>
<span id="cb12-25"><a aria-hidden="true" href="#cb12-25" tabindex="-1"></a>        <span class="fu">tm_polygons</span>(</span>
<span id="cb12-26"><a aria-hidden="true" href="#cb12-26" tabindex="-1"></a>            <span class="at">col =</span> <span class="st">"imdrank"</span>,</span>
<span id="cb12-27"><a aria-hidden="true" href="#cb12-27" tabindex="-1"></a>            <span class="at">id =</span> <span class="st">"tmap_label"</span>,</span>
<span id="cb12-28"><a aria-hidden="true" href="#cb12-28" tabindex="-1"></a>            <span class="at">style =</span> <span class="st">"cont"</span>,</span>
<span id="cb12-29"><a aria-hidden="true" href="#cb12-29" tabindex="-1"></a>            <span class="at">legend.show =</span> <span class="cn">FALSE</span>,</span>
<span id="cb12-30"><a aria-hidden="true" href="#cb12-30" tabindex="-1"></a>            <span class="at">palette =</span> <span class="st">"-YlOrRd"</span></span>
<span id="cb12-31"><a aria-hidden="true" href="#cb12-31" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb12-32"><a aria-hidden="true" href="#cb12-32" tabindex="-1"></a>        <span class="fu">tm_facets</span>(<span class="at">by =</span> <span class="st">"region_fct"</span>) <span class="sc">+</span></span>
<span id="cb12-33"><a aria-hidden="true" href="#cb12-33" tabindex="-1"></a>        <span class="fu">tm_basemap</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb12-34"><a aria-hidden="true" href="#cb12-34" tabindex="-1"></a>        <span class="fu">tm_shape</span>(eng_lines) <span class="sc">+</span></span>
<span id="cb12-35"><a aria-hidden="true" href="#cb12-35" tabindex="-1"></a>        <span class="fu">tm_lines</span>(<span class="at">col =</span> <span class="st">"highlight_color"</span>, <span class="at">lwd =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb12-36"><a aria-hidden="true" href="#cb12-36" tabindex="-1"></a>        <span class="fu">tm_facets</span>(<span class="at">by =</span> <span class="st">"region_fct"</span>)</span>
<span id="cb12-37"><a aria-hidden="true" href="#cb12-37" tabindex="-1"></a>}</span>
<span id="cb12-38"><a aria-hidden="true" href="#cb12-38" tabindex="-1"></a></span>
<span id="cb12-39"><a aria-hidden="true" href="#cb12-39" tabindex="-1"></a><span class="fu">create_facet_map</span>(eng)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div style="display:inline;width:32%;float:left;border-style:solid;border-color:#BEBEBE;border-width:1px 1px 1px 1px;">
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-3015" style="width:100%;height:400px;"></div>
<script data-for="htmlwidget-3015" type="application/json"></script>
</div>
<div style="display:inline;width:32%;float:left;border-style:solid;border-color:#BEBEBE;border-width:1px 1px 1px 1px;">
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-7442" style="width:100%;height:400px;"></div>
<script data-for="htmlwidget-7442" type="application/json"></script>
</div>
<div style="display:inline;width:32%;float:left;border-style:solid;border-color:#BEBEBE;border-width:1px 1px 1px 1px;">
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-3927" style="width:100%;height:400px;"></div>
<script data-for="htmlwidget-3927" type="application/json"></script>
</div>
<div style="display:inline;width:32%;float:left;border-style:solid;border-color:#BEBEBE;border-width:1px 1px 1px 1px;">
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-9627" style="width:100%;height:400px;"></div>
<script data-for="htmlwidget-9627" type="application/json"></script>
</div>
<div style="display:inline;width:32%;float:left;border-style:solid;border-color:#BEBEBE;border-width:1px 1px 1px 1px;">
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-3246" style="width:100%;height:400px;"></div>
<script data-for="htmlwidget-3246" type="application/json"></script>
</div>
<div style="display:inline;width:32%;float:left;border-style:solid;border-color:#BEBEBE;border-width:1px 1px 1px 1px;">
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-1362" style="width:100%;height:400px;"></div>
<script data-for="htmlwidget-1362" type="application/json"></script>
</div>
<div style="display:inline;width:32%;float:left;border-style:solid;border-color:#BEBEBE;border-width:1px 1px 1px 1px;">
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-1221" style="width:100%;height:400px;"></div>
<script data-for="htmlwidget-1221" type="application/json"></script>
</div>
<div style="display:inline;width:32%;float:left;border-style:solid;border-color:#BEBEBE;border-width:1px 1px 1px 1px;">
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-9552" style="width:100%;height:400px;"></div>
<script data-for="htmlwidget-9552" type="application/json"></script>
</div>
<div style="display:inline;width:32%;float:left;border-style:solid;border-color:#BEBEBE;border-width:1px 1px 1px 1px;">
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-4255" style="width:100%;height:400px;"></div>
<script data-for="htmlwidget-4255" type="application/json"></script>
</div>

</div>
</div>
<p><br/></p>
<p>This method, too, sacrifices topological accuracy. Neighbouring authorities are in different facets, and not drawn on the same scale. This highlights the importance of asking: <em>who is the map for</em>? If it is for a national policymaker, or sub-national body divided across regional boundaries, it may be useful to compare regions. Conversely, local decision makers may wish to compare themselves to their neighbours, in which case a map like this may not be appropriate.</p>
<p>Using facets does not exclude the other methods. I have drawn the regional map here using geographic administrative boundaries, but the same approach could be used with the contiguous or non-contiguous polygons.</p>
</section>
<section class="level1 page-columns page-full" id="are-3d-maps-the-answer">
<h1>Are 3d maps the answer?</h1>
<p>We are trying to plot three dimensions: shape, intensity of deprivation and population. It is worth considering a three-dimensional map. We can create these using <a href="https://echarts4r.john-coene.com/"><code>echarts4r</code></a>, an R wrapper around <a href="https://echarts.apache.org/en/index.html">Apache ECharts</a>, an open source JavaScript visualisation library.</p>
<div class="no-row-height column-margin column-container"><div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
The 3d map is interactive
</div>
</div>
<div class="callout-body-container callout-body">
<p>Click and drag the map to pan and zoom</p>
</div>
</div></div><div class="cell page-columns page-full">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a aria-hidden="true" href="#cb13-1" tabindex="-1"></a><span class="fu">library</span>(echarts4r)</span>
<span id="cb13-2"><a aria-hidden="true" href="#cb13-2" tabindex="-1"></a></span>
<span id="cb13-3"><a aria-hidden="true" href="#cb13-3" tabindex="-1"></a></span>
<span id="cb13-4"><a aria-hidden="true" href="#cb13-4" tabindex="-1"></a><span class="co"># Create basic label (doesn't support html labels)</span></span>
<span id="cb13-5"><a aria-hidden="true" href="#cb13-5" tabindex="-1"></a>eng <span class="ot">&lt;-</span> eng <span class="sc">|&gt;</span></span>
<span id="cb13-6"><a aria-hidden="true" href="#cb13-6" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb13-7"><a aria-hidden="true" href="#cb13-7" tabindex="-1"></a>        <span class="at">echarts_label =</span> <span class="fu">paste0</span>(lad19nm, <span class="st">" </span><span class="sc">\n</span><span class="st">Rank: "</span>, imdrank, <span class="st">"</span><span class="sc">\n</span><span class="st">Score: "</span>, imdscore, <span class="st">"</span><span class="sc">\n</span><span class="st">Older pop: "</span>, <span class="fu">round</span>(pop60 <span class="sc">/</span> <span class="fl">1e3</span>), <span class="st">"k"</span>)</span>
<span id="cb13-8"><a aria-hidden="true" href="#cb13-8" tabindex="-1"></a>    )</span>
<span id="cb13-9"><a aria-hidden="true" href="#cb13-9" tabindex="-1"></a></span>
<span id="cb13-10"><a aria-hidden="true" href="#cb13-10" tabindex="-1"></a></span>
<span id="cb13-11"><a aria-hidden="true" href="#cb13-11" tabindex="-1"></a><span class="co"># Get the boundaries into the expected format by writing them</span></span>
<span id="cb13-12"><a aria-hidden="true" href="#cb13-12" tabindex="-1"></a><span class="co"># to a geojson string and then reading that string into a list</span></span>
<span id="cb13-13"><a aria-hidden="true" href="#cb13-13" tabindex="-1"></a>eng_geojson <span class="ot">&lt;-</span> eng <span class="sc">|&gt;</span></span>
<span id="cb13-14"><a aria-hidden="true" href="#cb13-14" tabindex="-1"></a>    <span class="co"># make `name` the label so it is displayed by default</span></span>
<span id="cb13-15"><a aria-hidden="true" href="#cb13-15" tabindex="-1"></a>    <span class="fu">select</span>(lad19cd, <span class="at">name =</span> echarts_label) <span class="sc">|&gt;</span></span>
<span id="cb13-16"><a aria-hidden="true" href="#cb13-16" tabindex="-1"></a>    geojsonsf<span class="sc">::</span><span class="fu">sf_geojson</span>() <span class="sc">|&gt;</span></span>
<span id="cb13-17"><a aria-hidden="true" href="#cb13-17" tabindex="-1"></a>    jsonlite<span class="sc">::</span><span class="fu">parse_json</span>()</span>
<span id="cb13-18"><a aria-hidden="true" href="#cb13-18" tabindex="-1"></a></span>
<span id="cb13-19"><a aria-hidden="true" href="#cb13-19" tabindex="-1"></a></span>
<span id="cb13-20"><a aria-hidden="true" href="#cb13-20" tabindex="-1"></a>eng_3d <span class="ot">&lt;-</span> eng <span class="sc">|&gt;</span></span>
<span id="cb13-21"><a aria-hidden="true" href="#cb13-21" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb13-22"><a aria-hidden="true" href="#cb13-22" tabindex="-1"></a>        <span class="at">scaled_pop60 =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(pop60, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">25</span>)),</span>
<span id="cb13-23"><a aria-hidden="true" href="#cb13-23" tabindex="-1"></a>        <span class="at">show =</span> <span class="cn">TRUE</span></span>
<span id="cb13-24"><a aria-hidden="true" href="#cb13-24" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb13-25"><a aria-hidden="true" href="#cb13-25" tabindex="-1"></a>    <span class="fu">e_charts</span>(echarts_label) <span class="sc">|&gt;</span></span>
<span id="cb13-26"><a aria-hidden="true" href="#cb13-26" tabindex="-1"></a>    <span class="fu">e_map_register</span>(<span class="st">"UK"</span>, eng_geojson) <span class="sc">|&gt;</span></span>
<span id="cb13-27"><a aria-hidden="true" href="#cb13-27" tabindex="-1"></a>    <span class="fu">e_geo_3d</span>(scaled_pop60, color,</span>
<span id="cb13-28"><a aria-hidden="true" href="#cb13-28" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">"UK"</span>,</span>
<span id="cb13-29"><a aria-hidden="true" href="#cb13-29" tabindex="-1"></a>        <span class="at">label =</span> <span class="fu">list</span>(</span>
<span id="cb13-30"><a aria-hidden="true" href="#cb13-30" tabindex="-1"></a>            <span class="at">fontSize =</span> <span class="dv">25</span></span>
<span id="cb13-31"><a aria-hidden="true" href="#cb13-31" tabindex="-1"></a>        ),</span>
<span id="cb13-32"><a aria-hidden="true" href="#cb13-32" tabindex="-1"></a>        <span class="at">viewControl =</span> <span class="fu">list</span>(</span>
<span id="cb13-33"><a aria-hidden="true" href="#cb13-33" tabindex="-1"></a>            <span class="at">maxAlpha =</span> <span class="dv">180</span>,</span>
<span id="cb13-34"><a aria-hidden="true" href="#cb13-34" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="dv">90</span>,</span>
<span id="cb13-35"><a aria-hidden="true" href="#cb13-35" tabindex="-1"></a>            <span class="at">distance =</span> <span class="dv">130</span> <span class="co"># zoom out a bit</span></span>
<span id="cb13-36"><a aria-hidden="true" href="#cb13-36" tabindex="-1"></a>        )</span>
<span id="cb13-37"><a aria-hidden="true" href="#cb13-37" tabindex="-1"></a>    )</span>
<span id="cb13-38"><a aria-hidden="true" href="#cb13-38" tabindex="-1"></a></span>
<span id="cb13-39"><a aria-hidden="true" href="#cb13-39" tabindex="-1"></a>eng_3d</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display column-body-outset">
<div class="echarts4r html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-2d8285741add3f8eefcb" style="width:100%;height:500px;"></div>
<script data-for="htmlwidget-2d8285741add3f8eefcb" type="application/json"></script>
</div>
</div>
<p>This is appealing, but the drawback is that the visibility of an area is a function of the areas surrounding it. This is particularly noticeable in London, which where it is difficult to judge the height of neighbouring authorities. This is partly caused by map area bias we see in geographic maps, as the 2-dimensional representation is based on the geographic shape. A 3d map is not limited to using geographic shapes. However, if you have a cartogram which creates shapes based on population, do you need a third dimesion?</p>
<p>This utility of these maps depend on who the information is for. Decision makers in small, individual areas might prefer a map where it is easier to compare themselves to their neighbours. National policymakers might find the overall picture useful. However, there may be methods which can achieve both.</p>
</section>
<section class="level1" id="dorling-cartograms">
<h1>Dorling cartograms</h1>
<p>A final option is to use <a href="http://www.ncgia.ucsb.edu/projects/Cartogram_Central/types.html">Dorling cartograms</a>, like the US election cartogram at the start of this document.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a aria-hidden="true" href="#cb14-1" tabindex="-1"></a>eng_dorling <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(eng, <span class="st">"EPSG:27700"</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a aria-hidden="true" href="#cb14-2" tabindex="-1"></a>    <span class="fu">cartogram_dorling</span>(</span>
<span id="cb14-3"><a aria-hidden="true" href="#cb14-3" tabindex="-1"></a>        <span class="at">weight =</span> <span class="st">"pop60"</span>,</span>
<span id="cb14-4"><a aria-hidden="true" href="#cb14-4" tabindex="-1"></a>        <span class="at">m_weight =</span> <span class="fl">0.4</span>, <span class="co"># Circle movement weights. 0 prevents any pair-repulsion.</span></span>
<span id="cb14-5"><a aria-hidden="true" href="#cb14-5" tabindex="-1"></a>        <span class="at">k =</span> <span class="fl">0.6</span> <span class="co"># share of the bounding box of x filled by the larger circle</span></span>
<span id="cb14-6"><a aria-hidden="true" href="#cb14-6" tabindex="-1"></a>    )</span>
<span id="cb14-7"><a aria-hidden="true" href="#cb14-7" tabindex="-1"></a><span class="fu">create_map</span>(eng_dorling, <span class="st">"leafletBlackDorling"</span>, <span class="at">second_legend =</span> <span class="cn">TRUE</span>)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="leafletBlackDorling" style="width:100%;height:464px;"></div>
<script data-for="leafletBlackDorling" type="application/json"></script>
</div>
</div>
<p><br/></p>
<p>With this approach, it is apparent that the north of England is relatively deprived, with geographically large, sparsely-populated areas like <span class="eden">Eden</span> appropriately small. This is appealing. Birmingham is now the largest area, which it should be, as it has the greatest population. The situation in in London is visible. However, we sacrifice geographical accuracy.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Geographical accuracy">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Geographical accuracy
</div>
</div>
<div class="callout-body-container callout-body">
<p>Geographical accuracy refers to how much the modified shapes and locations of each area resembles its geographical borders.<span class="citation" data-cites="nusrat2016state"><sup><a href="#ref-nusrat2016state" role="doc-biblioref">1</a></sup></span></p>
</div>
</div>
<p>As the circles can grow or shrink, the centroid of each polygon has to drift slightly to prevent overlapping. This requires some judgement. I have set the <code>k</code> parameter (share of the bounding box filled by the larger circle) to 0.6. If set too low, there’s very little difference in size between areas with different populations. If set too high, area circles become very large, and must repel away from their original position, resulting in a map which bears no relation at all to geography. This can be avoided by setting the <code>m_weight</code> parameter to zero, but that will create a incomprehensible map of overlapping circles. At the current settings, the shape of England is approximately maintained, though it may be difficult to locate a specific area.</p>
</section>
<section class="level1 page-columns page-full" id="which-map-is-best">
<h1>Which map is best?</h1>
<div class="no-row-height column-margin column-container"><div class="callout callout-style-default callout-note callout-titled">
<div aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout" class="callout-header d-flex align-content-center" data-bs-target=".callout-11-contents" data-bs-toggle="collapse">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Selection of long-term care papers with cartograms
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div class="callout-11-contents callout-collapse collapse" id="callout-11">
<div class="callout-body-container callout-body">
<ol type="1">
<li><strong>Ouchi, J. &amp; Hattori, K. Estimated number of short-stay service recipients in hokkaido prefecture, japan, from 2020 to 2045: <em>Estimation by machine learning and review of changing trend by cartogram. (2020).</em></strong><span class="citation" data-cites="ouchi2020estimated"><sup><a href="#ref-ouchi2020estimated" role="doc-biblioref">6</a></sup></span> This paper uses machine learning to predict future long-term nursing care demand in Japan’s prefectures. These are visualised using contiguous area-cartograms.</li>
<li><strong>Forder, J. &amp; Allan, S. <em>The impact of competition on quality and prices in the english care homes market.</em></strong><span class="citation" data-cites="forder2014impact"><sup><a href="#ref-forder2014impact" role="doc-biblioref">7</a></sup></span> This paper uses chloropleth maps to visualise market concentration of care home supply in England.</li>
<li><strong>Yalcin, M. <em>Mapping the global spatio-temporal dynamics of COVID-19 outbreak using cartograms during the first 150 days of the pandemic.</em></strong><span class="citation" data-cites="yalcin2022mapping"><sup><a href="#ref-yalcin2022mapping" role="doc-biblioref">8</a></sup></span>. This paper uses density-adjusted cartograms to visualise the spread of Covid-19 cases.</li>
<li><strong>Inns, T. et al. <em>Estimating the burden of care home gastroenteritis outbreaks in England, 2014–2016.</em></strong><span class="citation" data-cites="inns2019estimating"><sup><a href="#ref-inns2019estimating" role="doc-biblioref">9</a></sup></span>. This paper uses hex cartograms to visualise the rates of acute gastroenteritis in long-term care facilities.</li>
<li><strong>Gao, P., Zhang, H., Wu, Z. &amp; Wang, J. <em>Visualising the expansion and spread of coronavirus disease 2019 by cartograms</em></strong><span class="citation" data-cites="gao2020visualising"><sup><a href="#ref-gao2020visualising" role="doc-biblioref">10</a></sup></span>. This paper uses Dorling cartograms to examine the spread of Covid-19.</li>
</ol>
</div>
</div>
</div></div><p>The answer depends on the policy goal, but some maps are generally received better than others. Non-contiguous cartograms are the only type which are perfectly statistically, topologically and geographically accurate. However, they are also rated as the most boring type of map.<span class="citation" data-cites="nusrat2016evaluating"><sup><a href="#ref-nusrat2016evaluating" role="doc-biblioref">11</a></sup></span> There is no point presenting the results of your research if no one is interested. Users of maps prefer contiguous and Dorling cartograms across several domains (though this analysis was of static rather than interactive maps).<span class="citation" data-cites="nusrat2016evaluating"><sup><a href="#ref-nusrat2016evaluating" role="doc-biblioref">11</a></sup></span> Inspired by some of the domains in this research, I propose the following decision-making tool for long-term care policy focused maps and cartograms.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<div>
<pre class="mermaid mermaid-js">flowchart TD
    Q[Which level are policy decisions made?]
    Nat["Macro area (e.g. national)"]    
    Loc["Individual area (e.g. local)"]
    Geographic(Geographic map)
    Import([What is important])
    SimilarPop([Areas have similar size \n populations?])
    Dorling[Dorling]
    Hex[Hex cartogram]
    Cont[Contiguous cartogram]
    Noncont[Noncontiguous cartogram]
    Aes[Are aesthetics important?]
    Facets[Facets]
    Meaningful([Meaningful comparison between \n groups of areas?])
    MeaningfulNeighbours([Important to compare geographic \n neighbours?]) 
    

    Q --&gt; Nat
    Q --&gt; Loc
    Nat --&gt; SimilarPop
    Loc --&gt; MeaningfulNeighbours
    MeaningfulNeighbours --&gt;|Yes| Geographic
    MeaningfulNeighbours --&gt;|No| Import    
    %%Loc --&gt;|Adjacency important| Aes
    %%Loc --&gt;|Statistical accuracy important| Dorling
    %%Loc --&gt;|Create equal sized neighbours| Hex
    SimilarPop --&gt;|Yes| Import
    SimilarPop --&gt;|No| Meaningful
    %%Meaningful --&gt;|No| MeaningfulNeighbours
    %%MeaningfulNeighbours --&gt;|No| Dorling
    %%MeaningfulNeighbours --&gt;|Yes| Noncont  
    Meaningful --&gt;|No| Import  
    Meaningful --&gt;|Yes| Facets
    Import --&gt;|Adjacency| Aes
    Import --&gt;|Overall picture| Dorling
    Import --&gt;|Comparison across areas| Hex
    Aes --&gt;|Yes| Cont
    Aes --&gt;|No| Noncont
    Import --&gt;|Statistical accuracy| Noncont
</pre>
</div>
</div>
</div>
</div>
<p><br/></p>
<p>This flowchart is a complicated way of saying, “it depends”. For policymakers at the level of geographic boundaries of the data, the ability to immediately identify that area is crucial. Conversely, for regional or national policy questions, perhaps the most important area to highlight is the overall picture. Ultimately, as ever with communicating the results of research, the question is who is your audience?</p>
<p>Finally, this blog post is not exhaustive. There are other approaches to transforming a map while preserving topology (see e.g. Bouts et al., 2015<span class="citation" data-cites="bouts2015visual"><sup><a href="#ref-bouts2015visual" role="doc-biblioref">12</a></sup></span>). There are other methods for presenting data, such as mosaic and table cartograms (see e.g. Nusrat et al., 2016<span class="citation" data-cites="nusrat2016state"><sup><a href="#ref-nusrat2016state" role="doc-biblioref">1</a></sup></span>). Additionally, we have focused here on continuous data. Categorical opens the door to different maps altogether such as <a href="https://tarakc02.github.io/dot-density/">dot density maps</a>. This is the first post in the GoLTC Data Science Network, so if you are interested any of these topics, or others, please let us know.</p>
<section class="level2" id="a-note-on-reproducibility">
<h2 class="anchored" data-anchor-id="a-note-on-reproducibility">A note on reproducibility</h2>
<p>To run this code yourself, you can copy and paste the individual code chunks. Alternatively, to see all the code, including for the US maps created at the beginning of the, please visit the <a href="https://github.com/samrickman/goltc-dsn-maps-cartograms-blog#creating-interactive-maps-and-cartograms-with-r-and-javascript">github repo</a>.</p>
</section>
</section>
<div class="default" id="quarto-appendix"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div class="references csl-bib-body" data-line-spacing="2" id="refs" role="list">
<div class="csl-entry" id="ref-nusrat2016state" role="listitem">
<div class="csl-left-margin">1. </div><div class="csl-right-inline">Nusrat, S. &amp; Kobourov, S. The state of the art in cartograms. in <em>Computer graphics forum</em> vol. 35 619–642 (Wiley Online Library, 2016).</div>
</div>
<div class="csl-entry" id="ref-lovelace2019geocomputation" role="listitem">
<div class="csl-left-margin">2. </div><div class="csl-right-inline">Lovelace, R., Nowosad, J. &amp; Muenchow, J. <em>Geocomputation with r: Second edition</em>. (CRC Press, 2023).</div>
</div>
<div class="csl-entry" id="ref-carr1992hexagon" role="listitem">
<div class="csl-left-margin">3. </div><div class="csl-right-inline">Carr, D. B., Olsen, A. R. &amp; White, D. Hexagon mosaic maps for display of univariate and bivariate geographical data. <em>Cartography and Geographic Information Systems</em> <strong>19</strong>, 228–236 (1992).</div>
</div>
<div class="csl-entry" id="ref-dougenik1985algorithm" role="listitem">
<div class="csl-left-margin">4. </div><div class="csl-right-inline">Dougenik, J. A., Chrisman, N. R. &amp; Niemeyer, D. R. An algorithm to construct continuous area cartograms. <em>The Professional Geographer</em> <strong>37</strong>, 75–81 (1985).</div>
</div>
<div class="csl-entry" id="ref-olson1976noncontiguous" role="listitem">
<div class="csl-left-margin">5. </div><div class="csl-right-inline">Olson, J. M. Noncontiguous area cartograms. <em>The Professional Geographer</em> <strong>28</strong>, 371–380 (1976).</div>
</div>
<div class="csl-entry" id="ref-ouchi2020estimated" role="listitem">
<div class="csl-left-margin">6. </div><div class="csl-right-inline">Ouchi, J. &amp; Hattori, K. <span class="nocase">Estimated Number of Short-Stay Service Recipients in Hokkaido Prefecture, Japan, from 2020 to 2045: Estimation by Machine Learning and Review of Changing Trend by Cartogram</span>. (2020).</div>
</div>
<div class="csl-entry" id="ref-forder2014impact" role="listitem">
<div class="csl-left-margin">7. </div><div class="csl-right-inline">Forder, J. &amp; Allan, S. The impact of competition on quality and prices in the english care homes market. <em>Journal of Health Economics</em> <strong>34</strong>, 73–83 (2014).</div>
</div>
<div class="csl-entry" id="ref-yalcin2022mapping" role="listitem">
<div class="csl-left-margin">8. </div><div class="csl-right-inline">Yalcin, M. Mapping the global spatio-temporal dynamics of COVID-19 outbreak using cartograms during the first 150 days of the pandemic. <em>Geocarto International</em> <strong>37</strong>, 3791–3800 (2022).</div>
</div>
<div class="csl-entry" id="ref-inns2019estimating" role="listitem">
<div class="csl-left-margin">9. </div><div class="csl-right-inline">Inns, T. <em>et al.</em> <span class="nocase">Estimating the burden of care home gastroenteritis outbreaks in England, 2014–2016</span>. <em>BMC Infectious Diseases</em> <strong>19</strong>, 1–8 (2019).</div>
</div>
<div class="csl-entry" id="ref-gao2020visualising" role="listitem">
<div class="csl-left-margin">10. </div><div class="csl-right-inline">Gao, P., Zhang, H., Wu, Z. &amp; Wang, J. Visualising the expansion and spread of coronavirus disease 2019 by cartograms. <em>Environment and Planning A: Economy and Space</em> <strong>52</strong>, 698–701 (2020).</div>
</div>
<div class="csl-entry" id="ref-nusrat2016evaluating" role="listitem">
<div class="csl-left-margin">11. </div><div class="csl-right-inline">Nusrat, S., Alam, M. J. &amp; Kobourov, S. Evaluating cartogram effectiveness. <em>IEEE Transactions on Visualization and Computer Graphics</em> <strong>24</strong>, 1077–1090 (2016).</div>
</div>
<div class="csl-entry" id="ref-bouts2015visual" role="listitem">
<div class="csl-left-margin">12. </div><div class="csl-right-inline">Bouts, Q. W. <em>et al.</em> Visual encoding of dissimilarity data via topology-preserving map deformation. <em>IEEE Transactions on Visualization and Computer Graphics</em> <strong>22</strong>, 2200–2213 (2015).</div>
</div>
</div></section></div></main>
<!-- /main column -->

</div> <!-- /content -->
</body></html>